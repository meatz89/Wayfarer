/* ===== WAYFARER CONVERSATION SYSTEM CSS ===== */
/* Complete styling for card-based conversations */

/* === CONVERSATION LAYOUT === */

/* Location Context */
.location-context {
    background: #f9f3e9;
    padding: 8px 20px;
    border-bottom: 1px solid #c4a684;
    font-size: 11px;
    color: #7a6250;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.conversation-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

/* Header with deadline */
.conversation-header {
    background: #2c241a;
    color: #e8dcc4;
    padding: 10px 20px;
    border-bottom: 2px solid #5c4a3a;
    display: flex;
    justify-content: space-between;
    font-size: 13px;
}

.deadline-warning {
    color: #d4704a;
    font-weight: bold;
}

/* NPC Bar - separate from state */
.npc-bar {
    background: linear-gradient(to bottom, #f4e8d0, #e8dcc4);
    padding: 15px 20px;
    border-bottom: 2px solid #a68b6f;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* State and Flow grouped together */
.state-flow-section {
    background: #f9f3e9;
    padding: 12px 20px;
    border-bottom: 2px solid #c4a684;
    display: flex;
    justify-content: space-between;
    gap: 30px;
    align-items: center;
    width: 100%;
}

.npc-info {
    flex: 1;
}

.npc-name {
    color: #5c4a3a;
    font-size: 22px;
    font-weight: normal;
}

.npc-status {
    font-size: 12px;
    color: #7a6250;
    margin-top: 2px;
}

.emotional-state {
    display: flex;
    align-items: center;
    gap: 12px;
}

.state-label {
    font-size: 11px;
    color: #7a6250;
    text-transform: uppercase;
}

.state-name {
    font-size: 16px;
    font-weight: bold;
    color: #8b4726;
}

.state-effects {
    font-size: 11px;
    color: #7a6250;
}

/* === RESOURCE INDICATORS === */

/* Patience Display */
.patience-display {
    text-align: right;
}

.patience-label {
    font-size: 10px;
    color: #7a6250;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.patience-value {
    font-size: 20px;
    font-weight: bold;
    color: #5c4a3a;
}

/* Flow Display */
.flow-display {
    display: flex;
    align-items: center;
    gap: 10px;
}

.flow-label {
    font-size: 11px;
    color: #7a6250;
    text-transform: uppercase;
}

.flow-bar {
    display: flex;
    gap: 3px;
    align-items: center;
}

.flow-segment {
    width: 14px;
    height: 24px;
    border: 1px solid #a68b6f;
    background: #e8dcc4;
}

.flow-segment.filled {
    background: #7a8b5a;
}

.flow-segment.negative {
    background: #d4704a;
}

.flow-segment.positive {
    background: #7a8b5a;
}

.flow-segment.current {
    border: 2px solid #3d3429;
    box-shadow: 0 0 4px rgba(0,0,0,0.3);
}

.flow-value {
    font-size: 16px;
    font-weight: bold;
    color: #5c4a3a;
}

.flow-hint {
    font-size: 10px;
    color: #8b4726;
    margin-left: 10px;
}

.flow-warning {
    font-size: 11px;
    color: #d4704a;
    font-weight: bold;
    margin-left: 10px;
}

/* Focus Display Above Cards */
.focus-display-section {
    background: #f9f3e9;
    padding: 12px 25px;
    border-bottom: 1px solid #d4c5a0;
    display: flex;
    align-items: center;
    gap: 15px;
}

.focus-label {
    font-size: 11px;
    color: #7a6250;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.focus-dots {
    display: flex;
    gap: 4px;
}

.focus-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 1px solid #8b7355;
    background: #e8dcc4;
}

.focus-dot.available {
    background: #d4a76a;
}

.focus-dot.spent {
    background: #3d3429;
}

.focus-numbers {
    font-size: 18px;
    font-weight: bold;
    color: #5c4a3a;
}

.focus-note {
    font-size: 11px;
    color: #8b7355;
    font-style: italic;
    margin-left: auto;
}

/* === ATMOSPHERE AND RAPPORT BAR === */

.atmosphere-rapport-bar {
    background: #e8dcc4;
    padding: 10px 20px;
    border-bottom: 1px solid #c4a684;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.atmosphere-display {
    display: flex;
    align-items: center;
    gap: 10px;
}

.atmosphere-label {
    font-size: 11px;
    color: #7a6250;
    text-transform: uppercase;
}

.atmosphere-current {
    font-size: 14px;
    color: #5c4a3a;
    font-weight: bold;
}

.atmosphere-effect {
    font-size: 11px;
    color: #7a6250;
    font-style: italic;
}

/* Atmosphere-specific color schemes */
.atmosphere-neutral { 
    opacity: 0.6; 
}

.atmosphere-prepared { 
    border-color: #2e8b57;
    background: linear-gradient(135deg, #e6f5ed, #c8e6d3);
}

.atmosphere-receptive { 
    border-color: #4169e1;
    background: linear-gradient(135deg, #e6eef9, #c8d9f3);
}

.atmosphere-focused { 
    border-color: #ff8c00;
    background: linear-gradient(135deg, #fff4e6, #ffe4c8);
}

.atmosphere-patient { 
    border-color: #9370db;
    background: linear-gradient(135deg, #f2ecfb, #e3d3f5);
}

.atmosphere-volatile { 
    border-color: #dc143c;
    background: linear-gradient(135deg, #fbe6ea, #f5c8d0);
}

.atmosphere-final { 
    border-color: #8b0000;
    background: linear-gradient(135deg, #f5e6e6, #e6c8c8);
}

.atmosphere-informed { 
    border-color: #ffd700;
    background: linear-gradient(135deg, #fffacd, #fff4a3);
}

.atmosphere-exposed { 
    border-color: #ff1493;
    background: linear-gradient(135deg, #ffeef7, #ffc8e3);
}

.atmosphere-synchronized { 
    border-color: #00ced1;
    background: linear-gradient(135deg, #e6feff, #c8f3f4);
}

.atmosphere-pressured { 
    border-color: #b22222;
    background: linear-gradient(135deg, #f5e0e0, #e6c0c0);
}

/* === TOKEN DISPLAY === */

.token-strip {
    display: flex;
    gap: 15px;
    padding: 8px 20px;
    background: #f9f3e9;
    border-top: 1px solid #d4c5a0;
}

.token-item {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.9rem;
}

.token-label {
    color: #7a6250;
}

.token-value {
    font-focus: bold;
    color: #3d3429;
}

/* === CARD STYLES === */

.card {
    background: #faf4ea;
    border: 2px solid #c4a684;
    border-radius: 4px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.15s ease;
    position: relative;
}

.card:hover:not(.disabled):not(.promise) {
    background: #fefaf0;
    border-color: #a68b6f;
    transform: translateX(5px);
}

.card.disabled {
    opacity: 0.4;
    cursor: not-allowed;
    background: #e8dcc4;
}

.card.selected {
    border-color: #5a7a3a;
    box-shadow: 0 0 10px rgba(90, 122, 58, 0.5);
}

/* Promise/Request cards */
.card.promise {
    border-color: #8b4726;
    background: #fff9f0;
}

.card.promise.disabled {
    opacity: 0.5;
    background: #f0ebe4;
}

.card.promise:hover:not(.disabled) {
    border-color: #d4704a;
    transform: translateX(5px);
    background: #fffaf5;
}

.promise-threshold {
    background: #8b4726;
    color: #faf4ea;
    padding: 6px 12px;
    font-size: 12px;
    font-weight: bold;
    text-align: center;
}

.promise-threshold.promise-active {
    background: #5a7a3a;
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
}

.card-name {
    font-size: 14px;
    font-weight: bold;
    color: #5c4a3a;
}

.card-focus {
    width: 24px;
    height: 24px;
    background: #5c4a3a;
    color: #faf4ea;
    border-radius: 50%;
    text-align: center;
    line-height: 24px;
    font-weight: bold;
    font-size: 13px;
}

/* Card content flex layout */
.card-content {
    display: flex;
}

.card-main {
    flex: 1;
    padding: 15px;
}

.card-body {
    padding: 12px;
}

.card-properties {
    display: flex;
    gap: 4px;
    flex-wrap: wrap;
    margin-bottom: 8px;
}

.card-tag {
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 10px;
    font-focus: bold;
    text-transform: uppercase;
}

.tag-persistent {
    background: #d4e6d4;
    color: #3a5a3a;
}

/* Persistence Tags */
.persistence-tag {
    position: absolute;
    top: 0px;
    right: 15px;
    padding: 2px 8px;
    border-radius: 0 0 2px 2px;
    font-size: 9px;
    text-transform: uppercase;
    font-weight: bold;
}

.persistence-tag.impulse {
    background: #8b4726;
    color: #faf4ea;
}

.persistence-tag.opening {
    background: #5a7a8a;
    color: #faf4ea;
}

.tag-difficulty-easy {
    background: #d4e6d4;
    color: #3a5a3a;
}

.tag-difficulty-medium {
    background: #f5e6d4;
    color: #8a6a3a;
}

.tag-difficulty-hard {
    background: #f5d4d4;
    color: #8a3a3a;
}

.tag-difficulty-veryhard {
    background: #e6d4f5;
    color: #6a3a8a;
}

.card-text {
    font-size: 13px;
    line-height: 1.5;
    color: #5c4a3a;
    font-style: italic;
    margin-bottom: 10px;
}

/* Card outcomes - side by side success/failure */
.card-outcomes {
    display: flex;
    border-left: 1px solid #d4c5a0;
}

.outcome {
    padding: 15px;
    width: 140px;
    text-align: center;
    background: #f9f3e9;
}

.outcome.success {
    border-right: 1px solid #d4c5a0;
}

.outcome-chance {
    font-size: 20px;
    font-weight: bold;
    color: #5c4a3a;
    margin-bottom: 4px;
}

.outcome-label {
    font-size: 9px;
    text-transform: uppercase;
    color: #7a6250;
    margin-bottom: 6px;
}

.outcome-effect {
    font-size: 11px;
    color: #5c4a3a;
    font-weight: bold;
}

.outcome-modifiers {
    font-size: 10px;
    color: #7a6250;
    margin-top: 4px;
}

/* Exhaust effect strip */
.exhaust-effect {
    background: #3d3429;
    color: #e8dcc4;
    padding: 8px 15px;
    font-size: 11px;
    border-top: 1px solid #5c4a3a;
}

.exhaust-label {
    font-weight: bold;
    margin-right: 5px;
}

/* === CARD ANIMATIONS === */

/* Slide in from right for newly drawn cards */
@keyframes card-slide-in {
    from {
        transform: translateX(100px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* Success flash - green highlight */
@keyframes card-success-flash {
    0% {
        background-color: #faf4ea;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    20% {
        background-color: #d4ffd4;
        box-shadow: 0 0 20px rgba(0,255,0,0.5);
        transform: scale(1.05);
    }
    80% {
        background-color: #d4ffd4;
        box-shadow: 0 0 15px rgba(0,255,0,0.3);
        transform: scale(1.02);
    }
    100% {
        background-color: #faf4ea;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        transform: scale(1);
    }
}

/* Failure flash - red highlight */
@keyframes card-failure-flash {
    0% {
        background-color: #faf4ea;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    20% {
        background-color: #ffd4d4;
        box-shadow: 0 0 20px rgba(255,0,0,0.5);
    }
    40% {
    }
    80% {
        background-color: #ffd4d4;
        box-shadow: 0 0 15px rgba(255,0,0,0.3);
    }
    100% {
        background-color: #faf4ea;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
}

/* Exhaust animation - burn/dissolve effect */
@keyframes card-exhaust {
    0% {
        opacity: 1;
        filter: grayscale(0) brightness(1);
    }
    25% {
        opacity: 0.9;
        filter: grayscale(0.3) brightness(0.9) sepia(0.5);
    }
    50% {
        opacity: 0.7;
        filter: grayscale(0.6) brightness(0.7) sepia(0.8);
        background-color: #d4b896;
    }
    75% {
        opacity: 0.3;
        filter: grayscale(0.9) brightness(0.5) sepia(1);
        background-color: #8b7355;
    }
    100% {
        opacity: 0;
        filter: grayscale(1) brightness(0.3) sepia(1);
    }
}

/* Transition out for played cards */
@keyframes card-play-out {
    0% {
        transform: translateY(0) scale(1);
        opacity: 1;
    }
    100% {
        transform: translateY(-100px) scale(0.5);
        opacity: 0;
    }
}

/* Newly drawn cards */
.card-new {
    animation: card-slide-in 0.25s ease-out;
    animation-fill-mode: both;
}

/* Stagger animation for multiple new cards */
.card-new:nth-child(1) { animation-delay: 0s; }
.card-new:nth-child(2) { animation-delay: 0.05s; }
.card-new:nth-child(3) { animation-delay: 0.1s; }
.card-new:nth-child(4) { animation-delay: 0.15s; }
.card-new:nth-child(5) { animation-delay: 0.2s; }

/* Successfully played card */
.card-played-success {
    animation: card-success-flash 0.75s ease-out, card-play-out 0.25s ease-out 0.75s;
    animation-fill-mode: forwards;
    pointer-events: none;
}

/* Failed played card */
.card-played-failure {
    animation: card-failure-flash 0.75s ease-out, card-play-out 0.25s ease-out 0.75s;
    animation-fill-mode: forwards;
    pointer-events: none;
}

/* Exhausting cards (impulse/opening) */
.card-exhausting {
    animation: card-exhaust 0.5s ease-out;
    animation-fill-mode: forwards;
    pointer-events: none;
}

/* === ACTION SECTION === */

.action-section {
    padding: 15px;
    background: #e8dcc4;
    text-align: center;
    border-bottom: 1px solid #a68b6f;
}

.action-choices {
    display: flex;
    justify-content: center;
    gap: 30px;
}

.action-button {
    padding: 12px 40px;
    background: linear-gradient(to bottom, #f9f3e9, #f4e8d0);
    border: 2px solid #a68b6f;
    border-radius: 4px;
    color: #5c4a3a;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.15s ease;
    text-align: center;
    min-width: 180px;
}

.action-button:hover {
    background: linear-gradient(to bottom, #faf4ea, #f9f3e9);
    border-color: #8b7355;
    transform: translateY(-2px);
}

.action-details {
    font-size: 11px;
    margin-top: 4px;
    color: #7a6250;
}

/* === CARDS SECTION === */

.cards-section {
    padding: 20px;
    background: #f4e8d0;
}

.cards-header {
    text-align: center;
    margin-bottom: 15px;
}

.cards-title {
    font-size: 13px;
    color: #7a6250;
    text-transform: uppercase;
    text-align: center;
    margin-bottom: 15px;
}

.card-grid {
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 900px;
    margin: 0 auto;
}

/* === CONVERSATION NARRATIVE === */

.narrative-section {
    padding: 25px;
    background: #f4e8d0;
    border-bottom: 2px solid #a68b6f;
}

.narrative-text {
    padding: 15px;
    background: #faf4ea;
    border-radius: 2px;
    font-size: 14px;
    line-height: 1.6;
    color: #5c4a3a;
    margin-bottom: 12px;
}

.npc-dialogue {
    padding: 20px;
    background: #faf4ea;
    border-left: 3px solid #a68b6f;
    border-radius: 2px;
    font-size: 16px;
    line-height: 1.6;
    font-style: italic;
}

.npc-dialogue.disconnected {
    border-left-color: #8b4726;
    background: #faf0e6;
}

/* === SPECIAL CARD TYPES === */

.card.flow {
    border-left: 5px solid #7a8b5a;
}

.card.state {
    border-left: 5px solid #8b7355;
}

.card.crisis {
    border-left: 5px solid #8b4726;
    background: #faf0e6;
}

.card.impulse-warning {
    position: relative;
    overflow: visible;
}

.card.impulse-warning::before {
    content: 'âš¡ Will exhaust';
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    background: #ff9800;
    color: white;
    padding: 2px 8px;
    border-radius: 3px;
    font-size: 11px;
    font-focus: bold;
}

/* === RESPONSIVE DESIGN === */

@media (max-width: 768px) {
    .card-grid {
        max-width: 100%;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .conversation-state-bar {
        flex-direction: column;
        gap: 10px;
    }
}

/* === RAPPORT DISPLAY === */

.rapport-display {
    display: flex;
    align-items: center;
    gap: 10px;
}

.rapport-label {
    font-size: 11px;
    color: #7a6250;
    text-transform: uppercase;
}

.rapport-value {
    font-size: 20px;
    font-weight: bold;
    color: #5a7a3a;
}

.rapport-effect {
    font-size: 11px;
    color: #5a7a3a;
    font-style: italic;
}
/* ==================== AI-Generated Content Styling ==================== */
/* Visually distinguishes AI-generated narrative from JSON fallback */

/* AI-Generated content - more natural, flowing appearance */
.narrative-text.ai-generated,
.npc-dialogue.ai-generated {
    position: relative;
    background: linear-gradient(135deg, #faf4ea 0%, #f5ede0 100%);
    border-left: 3px solid #8a7a6a;
}

.narrative-text.ai-generated::before,
.npc-dialogue.ai-generated::before {
    content: "AI";
    position: absolute;
    top: -8px;
    right: 10px;
    padding: 2px 6px;
    background: #8a7a6a;
    color: #faf4ea;
    font-size: 9px;
    font-weight: bold;
    border-radius: 2px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* JSON Fallback content - more structured, template-like appearance */
.narrative-text.json-fallback,
.npc-dialogue.json-fallback {
    position: relative;
    background: #f5f0e8;
    border-left: 3px solid #6a7a8a;
}

.narrative-text.json-fallback::before,
.npc-dialogue.json-fallback::before {
    content: "TEMPLATE";
    position: absolute;
    top: -8px;
    right: 10px;
    padding: 2px 6px;
    background: #6a7a8a;
    color: #faf4ea;
    font-size: 9px;
    font-weight: bold;
    border-radius: 2px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Card text AI/Template flags */
.card-text.ai-generated::before {
    content: "AI";
    position: absolute;
    top: 5px;
    right: 10px;
    padding: 2px 6px;
    background: #8a7a6a;
    color: #faf4ea;
    font-size: 9px;
    font-weight: bold;
    border-radius: 2px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.card-text.json-fallback::before {
    content: "TEMPLATE";
    position: absolute;
    top: 5px;
    right: 10px;
    padding: 2px 6px;
    background: #6a7a8a;
    color: #faf4ea;
    font-size: 9px;
    font-weight: bold;
    border-radius: 2px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Ensure card-text has relative positioning for flag placement */
.card-text {
    position: relative;
}

/* Loading state for narrative while AI is generating */
.narrative-text.narrative-loading,
.npc-dialogue.narrative-loading {
    opacity: 0.8;
    animation: narrativeLoading 2s ease-in-out infinite;
}

@keyframes narrativeLoading {
    0%, 100% {
        opacity: 0.8;
    }
    50% {
        opacity: 0.6;
    }
}

/* Subtle animation for AI content to indicate dynamic generation */
.narrative-text.ai-generated,
.npc-dialogue.ai-generated {
    animation: aiGlow 3s ease-in-out infinite;
    transition: opacity 0.3s ease-in, background 0.3s ease-in;
}

@keyframes aiGlow {
    0%, 100% {
        box-shadow: 0 2px 4px rgba(138, 122, 106, 0.1);
    }
    50% {
        box-shadow: 0 2px 8px rgba(138, 122, 106, 0.2);
    }
}
