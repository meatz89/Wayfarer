
@using Wayfarer.Pages.Components

@* Unified Attention Bar - REMOVED per user request *@

<div class="location-screen">
    @if (Model != null)
    {
        <!-- Header -->
        <div class="header">
            <div class="time-bar">
                <span class="current-time">@Model.CurrentTime</span>
                @if (!string.IsNullOrEmpty(Model.DeadlineTimer))
                {
                    <span class="deadline-warning">@Model.DeadlineTimer</span>
                }
            </div>
        </div>

        <!-- Location Header -->
        <div class="location-header">
            @if (Model.LocationPath?.Any() == true)
            {
                <div class="location-path">
                    @for (int i = 0; i < Model.LocationPath.Count; i++)
                    {
                        <span>@Model.LocationPath[i]</span>
                        @if (i < Model.LocationPath.Count - 1)
                        {
                            <span>â†’</span>
                        }
                    }
                </div>
            }
            <div class="location-name">@Model.LocationName</div>
            @if (Model.LocationTraits?.Any() == true)
            {
                <div class="location-traits">
                    @foreach (var trait in Model.LocationTraits)
                    {
                        <span class="trait">@trait</span>
                    }
                </div>
            }
        </div>

        <div class="content-area">
            @if (!string.IsNullOrEmpty(Model.AtmosphereText))
            {
                <div class="atmosphere-text">
                    @Model.AtmosphereText
                </div>
            }

            <!-- Quick Actions -->
            @if (Model.QuickActions?.Any() == true)
            {
                <div class="action-grid">
                    @foreach (var action in Model.QuickActions)
                    {
                        <div class="action-card" @onclick="() => ExecuteAction(action)">
                            <div class="action-cost">@action.Cost</div>
                            <div class="action-icon">@action.Icon</div>
                            <div class="action-title">@action.Title</div>
                            <div class="action-detail">@action.Detail</div>
                        </div>
                    }
                </div>
            }

            <!-- NPCs Present -->
            @if (Model.NPCsPresent?.Any() == true)
            {
                @foreach (var npc in Model.NPCsPresent)
                {
                    <div class="npc-present">
                        <div class="npc-header">
                            <div>
                                <div class="npc-name">@npc.Name</div>
                            </div>
                            <div class="npc-mood">@npc.MoodEmoji</div>
                        </div>
                        <div class="npc-description">
                            @npc.Description
                        </div>
                        @if (npc.Interactions?.Any() == true)
                        {
                            <div class="interaction-options">
                                @foreach (var interaction in npc.Interactions)
                                {
                                    <div class="interaction" @onclick="() => StartInteraction(npc, interaction)">
                                        <span>@interaction.Text</span>
                                        <span style="font-size: 11px;">@interaction.Cost</span>
                                    </div>
                                }
                            </div>
                        }
                    </div>
                }
            }

            <!-- Observations -->
            @if (Model.Observations?.Any() == true)
            {
                <div class="observations">
                    <div class="section-header">@Model.ObservationHeader</div>
                    <div class="observation-note">Knowledge gained here becomes conversation ammunition. Each observation converts to an Opportunity card when talking to relevant NPCs.</div>
                    @foreach (var obs in Model.Observations)
                    {
                        <div class="observation-item @(obs.IsObserved ? "observed" : "")">
                            <span class="observation-text">@(obs.IsObserved ? "âœ“ " : "")@obs.Text</span>
                            <span class="observation-details">
                                @if (!obs.IsObserved)
                                {
                                    <span class="observation-cost">@obs.AttentionCost attention</span>
                                }
                                <span class="observation-relevance">@obs.Relevance</span>
                            </span>
                        </div>
                    }
                </div>
            }
            
            <!-- Areas Within Location -->
            @if (Model.AreasWithinLocation?.Any() == true)
            {
                <div class="section-header">Areas Within @Model.LocationName</div>
                <div class="area-list">
                    @foreach (var area in Model.AreasWithinLocation)
                    {
                        <div class="area-option @(area.IsCurrent ? "current" : "")" @onclick="() => NavigateToArea(area)">
                            <div>
                                <div class="area-name">@area.Name</div>
                                <div class="area-detail">@area.Detail</div>
                            </div>
                            <span style="font-size: 11px; color: @(area.IsCurrent ? "#8b7355" : "#7a6250");">
                                @(area.IsCurrent ? "You are here" : "No travel time")
                            </span>
                        </div>
                    }
                </div>
            }

            <!-- Movement Options -->
            @if (Model.Routes?.Any() == true)
            {
                <div class="movement-grid">
                    @foreach (var route in Model.Routes)
                    {
                        <div class="route-option" @onclick="() => TravelTo(route)">
                            <span class="route-destination">@route.Destination</span>
                            <div class="route-details">
                                <span>ðŸš¶ @route.TravelTime</span>
                                <span>@route.Detail</span>
                            </div>
                        </div>
                    }
                </div>
            }

            <!-- Travel Progress (if traveling) -->
            @if (Model.TravelProgress != null)
            {
                <div class="travel-progress">
                    <div class="travel-progress-title">@Model.TravelProgress.Title</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: @(Model.TravelProgress.ProgressPercent)%;"></div>
                    </div>
                    <div class="travel-time-remaining">
                        @Model.TravelProgress.TimeWalked â€¢ @Model.TravelProgress.TimeRemaining
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="loading">Loading location...</div>
    }
</div>