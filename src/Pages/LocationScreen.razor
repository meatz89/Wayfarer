@using Wayfarer.ViewModels
@using Wayfarer.Pages.Components

<div class="main-container">
    @* Unified Attention Bar - Persistent across all screens *@
    <UnifiedAttentionBar />
    
    @if (Model != null)
    {
        <!-- Header -->
        <div class="location-header-bar">
            <div class="time-bar">
                <span>@Model.CurrentTime</span>
                @if (!string.IsNullOrEmpty(Model.DeadlineTimer))
                {
                    <span class="deadline-timer">@Model.DeadlineTimer</span>
                }
            </div>
        </div>

        <!-- Location Header -->
        <div class="location-info-header">
            @if (Model.LocationPath?.Any() == true)
            {
                <div class="location-path">
                    @for (int i = 0; i < Model.LocationPath.Count; i++)
                    {
                        <span>@Model.LocationPath[i]</span>
                        @if (i < Model.LocationPath.Count - 1)
                        {
                            <span>â†’</span>
                        }
                    }
                </div>
            }
            <div class="location-title">@Model.LocationName</div>
        </div>

        <div class="location-content">
            @if (!string.IsNullOrEmpty(Model.AtmosphereText))
            {
                <div class="atmosphere-text">
                    @Model.AtmosphereText
                </div>
            }

            <!-- Quick Actions -->
            @if (Model.QuickActions?.Any() == true)
            {
                <div class="action-grid">
                    @foreach (var action in Model.QuickActions)
                    {
                        <div class="action-card" @onclick="() => ExecuteAction(action)">
                            <div class="action-cost">@action.Cost</div>
                            <div class="action-icon">@action.Icon</div>
                            <div class="action-title">@action.Title</div>
                            <div class="action-detail">@action.Detail</div>
                        </div>
                    }
                </div>
            }

            <!-- NPCs Present -->
            @if (Model.NPCsPresent?.Any() == true)
            {
                @foreach (var npc in Model.NPCsPresent)
                {
                    <div class="npc-present">
                        <div class="npc-header">
                            <div>
                                <div class="npc-name">@npc.Name</div>
                            </div>
                            <div class="npc-mood">@npc.MoodEmoji</div>
                        </div>
                        <div class="npc-description">
                            @npc.Description
                        </div>
                        @if (npc.Interactions?.Any() == true)
                        {
                            <div class="interaction-options">
                                @foreach (var interaction in npc.Interactions)
                                {
                                    <div class="interaction" @onclick="() => StartInteraction(npc, interaction)">
                                        <span>@interaction.Text</span>
                                        <span style="font-size: 11px;">@interaction.Cost</span>
                                    </div>
                                }
                            </div>
                        }
                    </div>
                }
            }

            <!-- Observations -->
            @if (Model.Observations?.Any() == true)
            {
                <div class="observations">
                    <div class="observation-header">@Model.ObservationHeader</div>
                    <div class="observable-list">
                        @foreach (var obs in Model.Observations)
                        {
                            <div class="observable @(obs.IsUnknown ? "unknown" : "")">
                                <span>@obs.Icon</span>
                                <span>@obs.Text</span>
                            </div>
                        }
                    </div>
                </div>
            }

            <!-- Movement Options -->
            @if (Model.Routes?.Any() == true)
            {
                <div class="movement-grid">
                    @foreach (var route in Model.Routes)
                    {
                        <div class="route-option" @onclick="() => TravelTo(route)">
                            <span class="route-destination">@route.Destination</span>
                            <div class="route-details">
                                <span>ðŸš¶ @route.TravelTime</span>
                                <span>@route.Detail</span>
                            </div>
                        </div>
                    }
                </div>
            }

            <!-- Travel Progress (if traveling) -->
            @if (Model.TravelProgress != null)
            {
                <div class="travel-progress">
                    <div class="travel-progress-title">@Model.TravelProgress.Title</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: @(Model.TravelProgress.ProgressPercent)%;"></div>
                    </div>
                    <div class="travel-time-remaining">
                        @Model.TravelProgress.TimeWalked â€¢ @Model.TravelProgress.TimeRemaining
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="loading">Loading location...</div>
    }
</div>