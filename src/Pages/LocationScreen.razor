
@using Wayfarer.Pages.Components

@* Unified Attention Bar - REMOVED per user request *@

<div class="location-screen">
    @if (Model != null)
    {
        <!-- Unified Header with Resources and Time -->
        <div class="header">
            <div class="resource-group">
                <div class="resource">
                    <div class="resource-icon coins"></div>
                    <div class="resource-value">@GetPlayerCoins()</div>
                    <span>Coins</span>
                </div>
                <div class="resource @(GetPlayerHealth() < 30 ? "low" : "") @(GetPlayerHealth() < 15 ? "critical" : "")">
                    <div class="resource-icon health"></div>
                    <div class="resource-value">@GetPlayerHealth()</div>
                    <span>Health</span>
                </div>
                <div class="resource @(GetPlayerHunger() > 60 ? "low" : "") @(GetPlayerHunger() > 80 ? "critical" : "")">
                    <div class="resource-icon hunger"></div>
                    <div class="resource-value">@GetPlayerHunger()</div>
                    <span>Hunger</span>
                </div>
                <div class="resource">
                    <div class="resource-icon attention"></div>
                    <div class="resource-value">@GetPlayerAttention()/@GetMaxAttention()</div>
                    <span>Attention</span>
                </div>
            </div>
            <div class="time-display">
                <span class="current-time">@GetCurrentTimeDisplay()</span>
                @if (GetUrgentDeadline() != null)
                {
                    <span class="deadline-warning">@GetUrgentDeadline()</span>
                }
            </div>
            <div class="time-period">
                @GetCurrentTimeBlock()
            </div>
        </div>

        <!-- Obligations Panel -->
        <DeadlinePanel />

        <!-- Location Header -->
        <div class="location-header">
            @if (Model.LocationPath?.Any() == true)
            {
                <div class="location-path">
                    @for (int i = 0; i < Model.LocationPath.Count; i++)
                    {
                        <span>@Model.LocationPath[i]</span>
                        @if (i < Model.LocationPath.Count - 1)
                        {
                            <span>â†’</span>
                        }
                    }
                </div>
            }
            <div class="location-name">@Model.LocationName</div>
            @if (!string.IsNullOrEmpty(Model.CurrentSpotName))
            {
                <div class="current-spot-indicator">
                    <span class="spot-label">You are at:</span>
                    <span class="spot-name">@Model.CurrentSpotName</span>
                </div>
            }
            @if (Model.LocationTraits?.Any() == true)
            {
                <div class="location-traits">
                    @foreach (var trait in Model.LocationTraits)
                    {
                        <span class="trait">@trait</span>
                    }
                </div>
            }
        </div>

        <div class="content-area">
            @if (!string.IsNullOrEmpty(Model.AtmosphereText))
            {
                <div class="atmosphere-text">
                    @Model.AtmosphereText
                </div>
            }

            <!-- Quick Actions -->
            @if (Model.QuickActions?.Any() == true)
            {
                <div class="section-header">Actions</div>
                <div class="main-actions">
                    @foreach (var action in Model.QuickActions)
                    {
                        <div class="action-button" @onclick="() => ExecuteAction(action)">
                            <div class="action-name">@action.Title</div>
                            <div class="action-detail">@action.Detail</div>
                            <div class="action-cost">@action.Cost</div>
                        </div>
                    }
                </div>
            }

            <!-- NPCs Present -->
            @if (Model.NPCsPresent?.Any() == true)
            {
                <div class="section-header">People of Note</div>
                @foreach (var npc in Model.NPCsPresent)
                {
                    <div class="npc-present">
                        <div class="npc-header">
                            <div>
                                <div class="npc-name">@npc.Name</div>
                                @if (!string.IsNullOrEmpty(npc.EmotionalStateName))
                                {
                                    <div class="npc-state @GetStateClass(npc.EmotionalStateName)">@npc.EmotionalStateName</div>
                                }
                            </div>
                        </div>
                        <div class="npc-description">
                            @npc.Description
                        </div>
                        @if (npc.Interactions?.Any() == true)
                        {
                            <div class="interaction-options">
                                @foreach (var interaction in npc.Interactions)
                                {
                                    <div class="interaction" @onclick="() => StartInteraction(npc, interaction)">
                                        <span>@interaction.Text</span>
                                        <span style="font-size: 11px;">@interaction.Cost</span>
                                    </div>
                                }
                            </div>
                        }
                    </div>
                }
            }

            <!-- Observations -->
            @if (Model.Observations?.Any() == true)
            {
                <div class="observations">
                    <div class="section-header">@Model.ObservationHeader</div>
                    <div class="observation-note">Knowledge gained here becomes conversation ammunition. Each observation converts to an Opportunity card when talking to relevant NPCs.</div>
                    @foreach (var obs in Model.Observations)
                    {
                        <div class="observation-item @(obs.IsObserved ? "observed" : "clickable")" @onclick="() => TakeObservation(obs)">
                            <span class="observation-text">@(obs.IsObserved ? "âœ“ " : "")@obs.Text</span>
                            <span class="observation-details">
                                @if (!obs.IsObserved)
                                {
                                    <span class="observation-cost">@obs.AttentionCost attention</span>
                                }
                                <span class="observation-relevance">@obs.Relevance</span>
                            </span>
                        </div>
                    }
                </div>
            }
            
            <!-- Areas Within Location -->
            @if (Model.AreasWithinLocation?.Any() == true)
            {
                <div class="section-header">Areas Within @Model.LocationName</div>
                <div class="area-list">
                    @foreach (var area in Model.AreasWithinLocation)
                    {
                        <div class="area-option @(area.IsCurrent ? "current" : "")" @onclick="() => NavigateToArea(area)">
                            <div>
                                <div class="area-name">
                                    @area.Name
                                    @if (area.IsTravelHub)
                                    {
                                        <span style="margin-left: 5px; color: #8b7355;">ðŸš¶</span>
                                    }
                                </div>
                                <div class="area-detail">
                                    @area.Detail
                                    @if (area.IsTravelHub)
                                    {
                                        <span style="color: #8b7355;"> â€¢ Travel Hub</span>
                                    }
                                </div>
                            </div>
                            <span style="font-size: 11px; color: @(area.IsCurrent ? "#8b7355" : "#7a6250");">
                                @(area.IsCurrent ? "You are here" : "No travel time")
                            </span>
                        </div>
                    }
                </div>
            }


            <!-- Travel Progress (if traveling) -->
            @if (Model.TravelProgress != null)
            {
                <div class="travel-progress">
                    <div class="travel-progress-title">@Model.TravelProgress.Title</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: @(Model.TravelProgress.ProgressPercent)%;"></div>
                    </div>
                    <div class="travel-time-remaining">
                        @Model.TravelProgress.TimeWalked â€¢ @Model.TravelProgress.TimeRemaining
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="loading">Loading location...</div>
    }
</div>

<!-- Travel Modal -->
<TravelModal IsVisible="@ShowTravelModal"
             CurrentLocationName="@Model?.LocationName"
             Routes="@Model?.Routes"
             OnRouteSelected="@HandleRouteSelected"
             OnClose="@CloseTravelModal" />