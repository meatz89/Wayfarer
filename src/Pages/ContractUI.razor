@using Wayfarer.Game.ActionSystem
@using Wayfarer.Game.MainSystem
@inherits ContractUIBase

<div class="contracts-list">
    @if (AvailableContracts.Any())
    {
        @foreach (var contract in AvailableContracts)
        {
            var contractStatus = ContractRepository.GetContractStatus(contract.Id);
            int daysRemaining = contract.DueDay - GameWorld.CurrentDay;
            bool canComplete = contractStatus.Status == ContractStatus.Completed;

            <div class="contract-card">
                <div class="contract-header">
                    <div class="contract-title-section">
                        <h3 class="contract-name">@contract.Description</h3>
                        <div class="contract-meta">
                            <span class="contract-payment">💰 @contract.Payment coins</span>
                            <span class="contract-category">@contract.Category</span>
                            <span class="contract-priority priority-@contract.Priority.ToString().ToLower()">@contract.Priority</span>
                        </div>
                    </div>
                    <div class="contract-status-section">
                        <span class="contract-time @(daysRemaining <= 1 ? "urgent" : "")">
                            @(daysRemaining > 0 ? $"{daysRemaining} days" : "Due today!")
                        </span>
                        <div class="progress-indicator">
                            <span class="progress-status @contractStatus.Status.ToString().ToLower()">@contractStatus.Status</span>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: @((int)(contractStatus.ProgressPercentage * 100))%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                @if (contract.CompletionSteps.Any())
                {
                    <div class="contract-steps">
                        @foreach (var step in contract.CompletionSteps.OrderBy(s => s.OrderHint))
                        {
                            var stepRequirement = step.GetRequirement();
                            <div class="step-item @(step.IsCompleted ? "completed" : "pending")">
                                <span class="step-icon">@(step.IsCompleted ? "✅" : "🔲")</span>
                                <span class="step-text">@GetStepSummary(stepRequirement)</span>
                            </div>
                        }
                    </div>
                }

                @if (canComplete)
                {
                    <button class="complete-button" @onclick="() => CompleteContract(contract)">
                        Complete Contract
                    </button>
                }
                else if (contractStatus.Status == ContractStatus.Active)
                {
                    <div class="contract-hint">
                        Complete the steps above to finish this contract
                    </div>
                }
            </div>
        }
    }
    else
    {
        <div class="no-contracts">
            No contracts available at this time.
        </div>
    }
</div>
