@inherits EmergencyContentBase

@namespace Wayfarer.Pages.Components

<link rel="stylesheet" href="css/emergency-screen.css" />

@* ARCHITECTURAL PRINCIPLE: Screen components (LocationContent, ConversationContent, ExchangeContent, etc.) are rendered INSIDE GameScreen's game-container.
   They must NEVER define their own game-container, header, or resource bars - those are managed by the parent GameScreen.
   Screen components should only contain their specific content wrapped in a semantic class like 'emergency-content'. *@

@if (Context != null && Context.IsValid)
{
    <div class="emergency-content">
        <!-- Emergency Header with Urgency -->
        <div class="emergency-header @Context.GetUrgencyLevel().ToLower()">
            <div class="emergency-name">@Context.Emergency.Name</div>
            <div class="urgency-badge">@Context.GetUrgencyLevel()</div>
        </div>

        <!-- Location and Time Context -->
        <div class="location-context">
            <span>@Context.LocationName - @Context.TimeDisplay</span>
        </div>

        <!-- Time Pressure Display -->
        <div class="time-pressure">
            <div class="pressure-label">Response Window:</div>
            <div class="pressure-value @(Context.IsUrgent() ? "urgent" : "")">
                @Context.SegmentsRemaining segment(s) remaining
            </div>
        </div>

        <!-- Emergency Description -->
        <div class="emergency-description">
            <p>@Context.Emergency.Description</p>
        </div>

        <!-- Response Options Section -->
        <div class="responses-section">
            <h3>How will you respond?</h3>

            <!-- Affordable Responses -->
            @foreach (var response in Context.GetAffordableResponses())
            {
                <div class="response-option available" @onclick="() => HandleSelectResponse(response.Id)">
                    <div class="response-header">
                        <div class="response-text">@response.ResponseText</div>
                    </div>
                    @if (!string.IsNullOrEmpty(response.Description))
                    {
                        <div class="response-description">@response.Description</div>
                    }
                    <div class="response-costs">
                        @if (response.StaminaCost > 0)
                        {
                            <span class="cost-stamina">Stamina: @response.StaminaCost</span>
                        }
                        @if (response.HealthCost > 0)
                        {
                            <span class="cost-health">Health: @response.HealthCost</span>
                        }
                        @if (response.CoinCost > 0)
                        {
                            <span class="cost-coins">Coins: @response.CoinCost</span>
                        }
                        @if (response.TimeCost > 0)
                        {
                            <span class="cost-time">Time: @response.TimeCost segment(s)</span>
                        }
                    </div>
                </div>
            }

            <!-- Blocked Responses -->
            @foreach (var response in Context.GetBlockedResponses())
            {
                <div class="response-option blocked">
                    <div class="response-header">
                        <div class="response-text">@response.ResponseText</div>
                    </div>
                    @if (!string.IsNullOrEmpty(response.Description))
                    {
                        <div class="response-description">@response.Description</div>
                    }
                    <div class="blocked-reason">@Context.GetBlockReason(response)</div>
                </div>
            }
        </div>

        <!-- Resource Display -->
        <div class="resource-display">
            <div class="resource-item">
                <span class="resource-label">Stamina:</span>
                <span class="resource-value">@Context.CurrentStamina / @Context.MaxStamina</span>
            </div>
            <div class="resource-item">
                <span class="resource-label">Health:</span>
                <span class="resource-value">@Context.CurrentHealth / @Context.MaxHealth</span>
            </div>
            <div class="resource-item">
                <span class="resource-label">Coins:</span>
                <span class="resource-value">@Context.CurrentCoins</span>
            </div>
        </div>

        <!-- Ignore Option -->
        <div class="action-section">
            <button class="ignore-button" @onclick="HandleIgnore">Ignore This Emergency</button>
        </div>
    </div>
}
else if (Context != null)
{
    <div class="error-message">
        <p>@Context.ErrorMessage</p>
        <button @onclick="HandleReturn">Return</button>
    </div>
}
else
{
    <div class="loading">Loading emergency...</div>
}
