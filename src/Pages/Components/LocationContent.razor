@inherits LocationContentBase

@namespace Wayfarer.Pages.Components

<div class="location-content content-area">
    <!-- Atmospheric Description -->
    @if (CurrentSpot != null)
    {
        <LocationAtmosphereRenderer CurrentSpot="CurrentSpot" 
                                     CurrentTime="CurrentTime" 
                                     NPCsPresent="NPCsAtSpot" />
    }

    <!-- Available NPCs -->
    @if (AvailableNpcs.Any())
    {
        <div class="npcs-section">
            <h4 class="section-header">People Here</h4>
            <div class="npc-list">
                @foreach (var npc in AvailableNpcs)
                {
                    <div class="npc-card">
                        <div class="npc-header">
                            <div class="npc-name">@npc.Name</div>
                            <div class="npc-state @GetStateClass(npc.EmotionalState)">@npc.EmotionalState</div>
                        </div>
                        <div class="npc-description">@GetNPCDescription(npc)</div>
                        @if (npc.HasCrisis)
                        {
                            <div class="crisis-indicator">‚ö† Crisis</div>
                        }
                        <div class="npc-actions">
                            @foreach (var option in npc.ConversationOptions)
                            {
                                <div class="npc-action @GetActionClass(option.Type)" 
                                     @onclick="() => StartTypedConversation(npc.Id, option.Type)">
                                    <span class="action-type">@option.Label</span>
                                    <span class="action-details">
                                        @if (option.AttentionCost == 0)
                                        {
                                            <span class="action-reward">Free!</span>
                                        }
                                        else
                                        {
                                            <span>@option.AttentionCost attention</span>
                                        }
                                    </span>
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>
        </div>
    }

    <!-- Available Observations -->
    @if (AvailableObservations.Any())
    {
        <div class="observations">
            <div class="observation-note">You notice some interesting details about this place...</div>
            <div class="observation-list">
                @foreach (var obs in AvailableObservations)
                {
                    <div class="observation-item" @onclick="() => TakeObservation(obs.Id)">
                        <div class="observation-text">@obs.Name</div>
                        <div class="observation-reward">
                            <span class="reward-card">+Card</span>
                            <span class="action-details">1 attention</span>
                        </div>
                    </div>
                }
            </div>
        </div>
    }

    <!-- Available Spots -->
    @if (AvailableSpots.Any())
    {
        <div class="spots-section">
            <h4 class="section-header">Move Within Location</h4>
            <div class="spots-grid">
                @foreach (var spot in AvailableSpots)
                {
                    <div class="spot-card" @onclick="() => MoveToSpot(spot.Id)">
                        <div class="spot-card-name">@spot.Name</div>
                        @if (spot.Properties.Any())
                        {
                            <div class="spot-traits">
                                @foreach (var prop in spot.Properties)
                                {
                                    <span class="spot-trait">@prop</span>
                                }
                            </div>
                        }
                        <div class="spot-move-action">Move here (free)</div>
                    </div>
                }
            </div>
        </div>
    }

    <!-- Section Divider -->
    @if (CanTravel || CanWork)
    {
        <div class="section-divider">
            <span class="divider-text">Actions</span>
        </div>
    }

    <!-- Travel Option -->
    @if (CanTravel)
    {
        <div class="travel-section">
            <button class="travel-button" @onclick="NavigateToTravel">
                <span class="travel-icon">üó∫Ô∏è</span>
                <span>Travel to Another Location</span>
            </button>
        </div>
    }

    <!-- Work Action -->
    @if (CanWork)
    {
        <div class="actions-grid">
            <div class="action-card" @onclick="PerformWork">
                <div class="action-name">Work for Coins</div>
                <div class="action-cost">
                    <span class="cost-value">2</span> attention ‚Üí 
                    <span class="cost-value">8</span> coins
                </div>
            </div>
        </div>
    }
</div>