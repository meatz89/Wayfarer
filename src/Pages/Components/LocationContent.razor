@inherits LocationContentBase

@namespace Wayfarer.Pages.Components

@if (CurrentSpot != null)
{
    <!-- Venue Header -->
    <div class="location-header">
        <div class="location-path">
            @if (!string.IsNullOrEmpty(CurrentLocation?.Name))
            {
                <span>Lower Wards</span>
                <span class="icon-arrow-right"></span>
                <span>@CurrentLocation.Name</span>
            }
        </div>
        <div class="location-name">@CurrentLocation?.Name</div>
        <div class="location-traits">
            <span class="trait">Public</span>
            <span class="trait">@GetTimeOfDayTrait()</span>
        </div>
    </div>

    <!-- Current Spot Banner -->
    <div class="current-spot-banner">
        <div class="current-spot-name">@CurrentSpot.Name</div>
        <div class="spot-traits">
            @foreach (var prop in CurrentSpot.LocationProperties ?? new List<LocationPropertyType>())
            {
                <span class="spot-trait @GetSpotTraitClass(prop)">@GetSpotTraitDisplay(prop)</span>
            }
        </div>
    </div>

    <!-- VISUAL NOVEL SCENE NAVIGATION -->
    <div class="content-area">
        @* Atmosphere shown on Landing and Looking Around views *@
        @if ((ViewState == LocationViewState.Landing || ViewState == LocationViewState.LookingAround) && CurrentSpot != null)
        {
            <div class="atmosphere-text">
                <LocationAtmosphereRenderer CurrentLocation="CurrentSpot"
                                             CurrentTime="CurrentTime"
                                             NPCsPresent="NPCsAtSpot" />
            </div>
        }

        @* CONDITIONAL VIEW RENDERING - Render separate components *@
        @switch (ViewState)
        {
            case LocationViewState.Landing:
                <Landing HasNPCs="@AvailableNpcs.Any()"
                         HasLocationChallenges="@(AvailableMentalGoals.Any() || AvailablePhysicalGoals.Any())"
                         HasSpots="@AvailableSpots.Any()"
                         CurrentLocationName="@CurrentLocation?.Name"
                         TravelActions="@GetTravelActions()"
                         PlayerActions="@GetPlayerActions()"
                         OnNavigateToView="HandleNavigateToView"
                         OnExecuteLocationAction="HandleExecuteLocationAction" />
                break;

            case LocationViewState.LookingAround:
                <NPCListView AvailableNpcs="@AvailableNpcs"
                             OnNavigateToNPC="HandleNavigateToNPC"
                             OnNavigateBack="NavigateBack" />
                break;

            case LocationViewState.ApproachNPC:
                <NPCDetailView SelectedNPC="@GetSelectedNPCViewModel()"
                               SocialGoals="@GetSocialGoalsForNPC()"
                               NPCActiveGoals="@GetNPCActiveGoals()"
                               HasExchangeCards="@CheckHasExchangeCards()"
                               DoubtDisplay="@GetDoubtDisplayForSelectedNPC()"
                               OnNavigateToGoal="HandleNavigateToGoal"
                               OnStartConversationWithRequest="HandleStartConversationWithRequest"
                               OnStartExchange="HandleStartExchange"
                               OnNavigateBack="NavigateBack" />
                break;

            case LocationViewState.LocationChallenges:
                <LocationChallenges MentalGoals="@GetMentalGoalsViewModel()"
                                    PhysicalGoals="@GetPhysicalGoalsViewModel()"
                                    OnNavigateToGoal="HandleNavigateToGoal"
                                    OnNavigateBack="NavigateBack" />
                break;

            case LocationViewState.GoalDetail:
                <GoalDetailView SelectedGoal="@GetGoalDetailViewModel()"
                                OnCommitToGoal="HandleCommitToGoal"
                                OnNavigateBack="NavigateBack" />
                break;

            case LocationViewState.Spots:
                <SpotsView CurrentLocationName="@CurrentLocation?.Name"
                           AvailableSpots="@GetSpotsViewModel()"
                           OnMoveToSpot="HandleMoveToSpot"
                           OnNavigateBack="NavigateBack" />
                break;

            case LocationViewState.Equipment:
                <EquipmentInventory OnInventoryChanged="HandleInventoryChanged" />
                <div class="back-button-container">
                    <button class="back-button" @onclick="NavigateBack">‚Üê Back</button>
                </div>
                break;
        }
    </div>
}
else
{
    <div class="loading">
        Loading location...
    </div>
}
