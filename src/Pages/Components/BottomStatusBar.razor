@using Wayfarer.ViewModels
@inject GameFacade GameFacade
@inject ITimeManager TimeManager

<div class="bottom-status-bar">
    <div class="status-section">
        <span class="status-icon">ğŸ“</span>
        <span class="status-text">@GetCurrentLocation()</span>
    </div>
    
    <div class="status-section">
        <span class="status-icon">ğŸ“œ</span>
        <span class="status-text">Queue: @GetQueueStatus()</span>
    </div>
    
    <div class="status-section">
        <span class="status-icon">ğŸ’°</span>
        <span class="status-text">@GetCoinDisplay()</span>
    </div>
    
    <div class="status-section">
        <span class="status-icon">â°</span>
        <span class="status-text">@GetCurrentTime()</span>
    </div>
</div>

@code {
    private string GetCurrentLocation()
    {
        try
        {
            var (location, spot) = GameFacade.GetCurrentLocation();
            if (spot != null && !string.IsNullOrEmpty(spot.Name))
            {
                return spot.Name;
            }
            else if (location != null && !string.IsNullOrEmpty(location.Name))
            {
                return location.Name;
            }
            return "Market Square";
        }
        catch
        {
            return "Market Square";
        }
    }
    
    private string GetQueueStatus()
    {
        try
        {
            int count = GameFacade.GetLetterQueueCount();
            return $"{count}/8";
        }
        catch
        {
            return "0/8";
        }
    }
    
    private string GetCoinDisplay()
    {
        try
        {
            var inventory = GameFacade.GetInventory();
            if (inventory != null)
            {
                var coins = inventory.Coins;
                if (coins >= 100)
                {
                    return $"{coins / 100}g {coins % 100}s";
                }
                return $"{coins}s";
            }
            return "0s";
        }
        catch
        {
            return "0s";
        }
    }
    
    private string GetCurrentTime()
    {
        try
        {
            var day = TimeManager.GetCurrentDay();
            var dayName = new[] { "MON", "TUE", "WED", "THU", "FRI", "SAT", "SUN" }[day % 7];
            
            var currentHour = TimeManager.GetCurrentTimeHours();
            var currentMinute = TimeManager.GetCurrentMinutes();
            var period = currentHour >= 12 ? "PM" : "AM";
            var displayHour = currentHour > 12 ? currentHour - 12 : (currentHour == 0 ? 12 : currentHour);
            
            return $"{dayName} {displayHour}:{currentMinute:D2} {period}";
        }
        catch
        {
            return "MON 6:00 AM";
        }
    }
}