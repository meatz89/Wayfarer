@* Renders card dialogue from categorical templates - NO hardcoded text *@
@inject DialogueGenerationService DialogueGenerator
@inject NarrativeRenderer NarrativeRenderer

@code {
    [Parameter] public string TemplateId { get; set; }
    [Parameter] public CardContext Context { get; set; }
    [Parameter] public string NPCName { get; set; }
    [Parameter] public bool IsPlayerCard { get; set; } = true;

    private string GetCardText()
    {
        // Generate categorical template from card type
        var template = DialogueGenerator.GenerateCardDialogue(TemplateId, IsPlayerCard);
        
        // Render template to human-readable text
        var text = NarrativeRenderer.RenderTemplate(template);
        
        // Add NPC name if contextually appropriate - only in desperate state
        if (!string.IsNullOrEmpty(NPCName) && Context?.EmotionalState == EmotionalState.DESPERATE)
        {
            text = text.Replace("you", NPCName);
        }
        
        return text;
    }

    private string GetSuccessDescription()
    {
        var weight = GetCardWeight();
        var successChance = Math.Max(10, Math.Min(95, 70 - (weight * 10)));
        return $"{successChance}%";
    }

    private int GetCardWeight()
    {
        // Weight should come from the card data, not template matching!
        // This is a mechanical property that should be on the card itself
        // TODO: Get this from card.Weight property instead
        return 1; // Default weight until properly connected
    }

    private string GetCardTypeClass()
    {
        // Determine card visual category from template
        if (TemplateId != null && (TemplateId.Contains("Calm") || TemplateId.Contains("Opening")))
            return "state";
        return "comfort";
    }
}

@GetCardText()