@using Wayfarer.GameState.Actions
@using Wayfarer.GameState.Actions.Requirements

<div class="action-prerequisites">
    @if (Prerequisites != null && Prerequisites.Requirements.Any())
    {
        <div class="prerequisites-header">
            <span class="label">Requirements:</span>
        </div>
        
        <div class="requirements-list">
            @foreach (var status in Prerequisites.GetRequirementStatuses(Player, GameWorld))
            {
                <div class="requirement-item @(status.IsSatisfied ? "satisfied" : "unsatisfied")">
                    <div class="requirement-icon">
                        @if (status.IsSatisfied)
                        {
                            <span class="icon-check">âœ“</span>
                        }
                        else
                        {
                            <span class="icon-cross">âœ—</span>
                        }
                    </div>
                    
                    <div class="requirement-details">
                        <div class="requirement-description">
                            @status.Requirement.GetDescription()
                        </div>
                        
                        @if (!status.IsSatisfied)
                        {
                            <div class="requirement-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: @((int)(status.Progress * 100))%"></div>
                                </div>
                                <span class="progress-text">@((int)(status.Progress * 100))%</span>
                            </div>
                            
                            @if (status.Requirement.CanBeRemedied)
                            {
                                <div class="remediation-hint">
                                    ðŸ’¡ @status.Requirement.GetRemediationHint()
                                </div>
                            }
                        }
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="no-requirements">
            <span class="text-muted">No special requirements</span>
        </div>
    }
</div>

<style>
    .action-prerequisites {
        margin: 0.5rem 0;
        padding: 0.5rem;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        background: var(--bg-secondary);
    }
    
    .prerequisites-header {
        font-weight: bold;
        margin-bottom: 0.5rem;
        color: var(--text-secondary);
    }
    
    .requirements-list {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .requirement-item {
        display: flex;
        align-items: flex-start;
        gap: 0.5rem;
        padding: 0.25rem;
        border-radius: 3px;
        transition: background-color 0.2s;
    }
    
    .requirement-item.satisfied {
        background: rgba(0, 255, 0, 0.1);
    }
    
    .requirement-item.unsatisfied {
        background: rgba(255, 0, 0, 0.1);
    }
    
    .requirement-icon {
        flex-shrink: 0;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
    }
    
    .icon-check {
        color: #4CAF50;
    }
    
    .icon-cross {
        color: #f44336;
    }
    
    .requirement-details {
        flex: 1;
    }
    
    .requirement-description {
        font-size: 0.9rem;
        margin-bottom: 0.25rem;
    }
    
    .requirement-progress {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin: 0.25rem 0;
    }
    
    .progress-bar {
        flex: 1;
        height: 8px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 4px;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        background: var(--primary-color);
        transition: width 0.3s ease;
    }
    
    .progress-text {
        font-size: 0.8rem;
        color: var(--text-secondary);
        min-width: 35px;
        text-align: right;
    }
    
    .remediation-hint {
        font-size: 0.85rem;
        color: var(--info-color);
        font-style: italic;
        margin-top: 0.25rem;
    }
    
    .no-requirements {
        text-align: center;
        padding: 0.5rem;
    }
</style>

@code {
    [Parameter] public ActionPrerequisites Prerequisites { get; set; }
    [Parameter] public Player Player { get; set; }
    [Parameter] public GameWorld GameWorld { get; set; }
}