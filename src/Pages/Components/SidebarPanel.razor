@inherits ComponentBase

<div class="game-sidebar" @ref="SidebarRef">
    <div class="sidebar-section expanded">
        <div class="section-header" id="section-character">
            <span>Character</span>
        </div>

        <div class="section-content">
            <div class="archetype-portrait">
                <img src=@GetArchetypePortrait() />
            </div>

            <div class="player-character">
                <div class="character-detail">
                    <span class="detail-label">Name:</span>
                    <span class="detail-value">@PlayerState.Name</span>
                </div>
                <div class="character-detail">
                    <span class="detail-label">Level:</span>
                    <span class="detail-value">@PlayerState.Level</span>
                </div>
                <div class="character-detail">
                    <span class="detail-label">Experience:</span>
                    <span class="detail-value">@PlayerState.CurrentXP / @PlayerState.XPToNextLevel</span>
                </div>
                <div class="player-archetype">
                    <span class="archetype-icon">@StyleHelper.GetArchetypeIcon(PlayerState.Archetype)</span>
                    <span class="archetype-name">@PlayerState.Archetype</span>
                </div>
            </div>
        </div>
    </div>

    <div class="sidebar-section @(ExpandedSections[SidebarSections.skills] ? "expanded" : "collapsed")">
        <div class="section-header hover" id="section-skills" @onclick="() => ToggleSection(SidebarSections.skills)">
            <span>Skills</span>
            <span class="expand-icon">@(ExpandedSections[SidebarSections.skills] ? "‚ñº" : "‚ñ∫")</span>
        </div>

        @if (ExpandedSections[SidebarSections.skills])
        {
            <div class="section-content">
                <div class="skills-grid">
                    @foreach (var skill in GetPlayerSkills())
                    {
                        var type = skill.Item1;
                        var icon = skill.Item2;
                        var label = skill.Item3;
                        var lvl = PlayerState.Skills.GetLevelForSkill(type);
                        var xp = PlayerState.Skills.GetXPForSkill(type);
                        var next = PlayerState.Skills.GetXPToNextForSkill(type);
                        var pct = next > 0 ? (double)xp / next * 100 : 0;
                        <div class="player-skill">
                            <span class="skill-icon">@icon</span>
                            <span class="skill-label">@label</span>
                            <div class="skill-bar">
                                <span class="skill-level-left">Lv @lvl</span>
                                <div class="skill-progress">
                                    <div class="skill-progress-inner" style="width:@pct%"> </div>
                                </div>
                                <span class="skill-xp-right">@xp/@next</span>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
    </div>

    <div class="sidebar-section @(ExpandedSections[SidebarSections.resources] ? "expanded" : "collapsed")">
        <div class="section-header hover" id="section-resources" @onclick="() => ToggleSection(SidebarSections.resources)">
            <span>Resources</span>
            <span class="expand-icon">@(ExpandedSections[SidebarSections.resources] ? "‚ñº" : "‚ñ∫")</span>
        </div>

        @if (ExpandedSections[SidebarSections.resources])
        {
            <div class="section-content">
                <div class="resource-grid">
                    <div class="player-resource">
                        <span class="resource-icon" style="color: var(--resource-coins)">üí∞</span>
                        <span class="resource-label">Coins</span>
                        <span class="resource-value">@PlayerState.Coins</span>
                    </div>

                    <div class="player-resource">
                        <span class="resource-icon" style="color: var(--resource-food)">üçñ</span>
                        <span class="resource-label">Food</span>
                        <span class="resource-value">@PlayerState.Food</span>
                    </div>
                </div>
            </div>
        }
    </div>

    <div class="sidebar-section @(ExpandedSections[SidebarSections.inventory] ? "expanded" : "collapsed")">
        <div class="section-header hover" id="section-inventory" @onclick="() => ToggleSection(SidebarSections.inventory)">
            <span>Inventory</span>
            <span class="expand-icon">@(ExpandedSections[SidebarSections.inventory] ? "‚ñº" : "‚ñ∫")</span>
        </div>

        @if (ExpandedSections[SidebarSections.inventory])
        {
            <div class="section-content">
                <Inventory />
            </div>
        }
    </div>
</div>