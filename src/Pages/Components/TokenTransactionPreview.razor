@* Component to preview token changes from actions *@

<div class="token-transaction-preview">
    @if (TokenChanges != null && TokenChanges.Any())
    {
        <div class="transaction-header">
            <span class="transaction-label">Token Effects:</span>
        </div>
        <div class="token-changes">
            @foreach (var change in TokenChanges)
            {
                <div class="token-change @(change.Amount > 0 ? "gain" : "cost")">
                    <span class="change-amount">@(change.Amount > 0 ? "+" : "")@change.Amount</span>
                    <span class="token-icon">@GetTokenIcon(change.TokenType)</span>
                    <span class="token-type">@change.TokenType</span>
                    @if (!string.IsNullOrEmpty(change.NpcName))
                    {
                        <span class="with-npc">with @change.NpcName</span>
                    }
                </div>
                
                @if (ShowEffects && !string.IsNullOrEmpty(change.Effect))
                {
                    <div class="change-effect">
                        <small>@change.Effect</small>
                    </div>
                }
            }
        </div>
        
        @if (ShowNetEffect)
        {
            <div class="net-effect">
                @{
                    var netByType = TokenChanges
                        .GroupBy(c => c.TokenType)
                        .Select(g => new { Type = g.Key, Net = g.Sum(c => c.Amount) })
                        .Where(n => n.Net != 0);
                }
                @if (netByType.Any())
                {
                    <span class="net-label">Net:</span>
                    @foreach (var net in netByType)
                    {
                        <span class="net-change @(net.Net > 0 ? "positive" : "negative")">
                            @(net.Net > 0 ? "+" : "")@net.Net @GetTokenIcon(net.Type)
                        </span>
                    }
                }
            </div>
        }
    }
</div>

@code {
    @namespace Wayfarer.Pages.Components
    @using Wayfarer.Models
    
    [Parameter] public List<TokenChange> TokenChanges { get; set; }
    [Parameter] public bool ShowEffects { get; set; } = true;
    [Parameter] public bool ShowNetEffect { get; set; } = false;
    
    private string GetTokenIcon(ConnectionType type)
    {
        return type switch
        {
            ConnectionType.Trust => "‚ù§Ô∏è",
            ConnectionType.Commerce => "ü™ô",
            ConnectionType.Status => "üëë",
            ConnectionType.Shadow => "üåë",
            _ => "‚ùì"
        };
    }
}