@using Wayfarer.Services

<div class="modal-backdrop @(IsVisible ? "visible" : "")" @onclick="HandleBackdropClick">
    <div class="modal-content deadline-warning" @onclick:stopPropagation="true">
        <div class="modal-header warning-header">
            <h2>⚠️ Letter Deadline Warning</h2>
        </div>
        
        <div class="modal-body">
            <p class="warning-message">
                This action will take <strong>@TimeImpact?.Hours hour@(TimeImpact?.Hours != 1 ? "s" : "")</strong> 
                and advance time to <strong>@TimeImpact?.ResultTimeBlock.ToString().Replace("_", " ")</strong>@(TimeImpact?.WouldAdvanceDay == true ? " tomorrow" : "").
            </p>
            
            @if (TimeImpact?.LettersExpiring > 0)
            {
                <div class="expiring-letters-section">
                    <h3>The following letter@(TimeImpact.LettersExpiring != 1 ? "s" : "") will expire:</h3>
                    <ul class="expiring-letters-list">
                        @foreach (var letter in TimeImpact.AffectedLetters)
                        {
                            <li class="expiring-letter">
                                <span class="letter-route">@letter.Route</span>
                                <span class="deadline-info">
                                    (Currently @letter.CurrentDaysRemaining day@(letter.CurrentDaysRemaining != 1 ? "s" : "") left)
                                </span>
                            </li>
                        }
                    </ul>
                </div>
                
                <div class="consequences-warning">
                    <p>⚠️ <strong>Expired letters cannot be delivered and may damage your reputation!</strong></p>
                </div>
            }
            
            <div class="modal-actions">
                <button class="btn btn-danger" @onclick="ConfirmAction">
                    Proceed Anyway
                </button>
                <button class="btn btn-primary" @onclick="CancelAction">
                    Cancel Action
                </button>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter] public bool IsVisible { get; set; }
    [Parameter] public TimeImpactInfo TimeImpact { get; set; }
    [Parameter] public EventCallback OnConfirm { get; set; }
    [Parameter] public EventCallback OnCancel { get; set; }
    
    private async Task ConfirmAction()
    {
        await OnConfirm.InvokeAsync();
    }
    
    private async Task CancelAction()
    {
        await OnCancel.InvokeAsync();
    }
    
    private void HandleBackdropClick()
    {
        // Clicking backdrop cancels the action
        _ = CancelAction();
    }
}

<style>
    .modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }
    
    .modal-backdrop.visible {
        display: flex;
    }
    
    .modal-content {
        background: var(--bg-panel);
        border-radius: 8px;
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }
    
    .modal-content.deadline-warning {
        border: 2px solid var(--warning);
    }
    
    .modal-header {
        padding: 1.5rem;
        border-bottom: 1px solid var(--oak-mid);
    }
    
    .modal-header.warning-header {
        background: var(--warning-bg);
        color: var(--warning);
    }
    
    .modal-header h2 {
        margin: 0;
        font-size: 1.25rem;
    }
    
    .modal-body {
        padding: 1.5rem;
    }
    
    .warning-message {
        font-size: 1rem;
        margin-bottom: 1.5rem;
        line-height: 1.5;
    }
    
    .expiring-letters-section {
        background: var(--bg-dark);
        border: 1px solid var(--oak-mid);
        border-radius: 4px;
        padding: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .expiring-letters-section h3 {
        margin: 0 0 0.75rem 0;
        font-size: 1rem;
        color: var(--danger);
    }
    
    .expiring-letters-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .expiring-letter {
        padding: 0.5rem 0;
        border-bottom: 1px solid var(--oak-mid);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .expiring-letter:last-child {
        border-bottom: none;
    }
    
    .letter-route {
        font-weight: 600;
        color: var(--text-primary);
    }
    
    .deadline-info {
        font-size: 0.875rem;
        color: var(--text-secondary);
    }
    
    .consequences-warning {
        background: var(--danger-bg);
        border: 1px solid var(--danger);
        border-radius: 4px;
        padding: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .consequences-warning p {
        margin: 0;
        color: var(--danger);
    }
    
    .modal-actions {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
    }
    
    .btn {
        padding: 0.5rem 1.5rem;
        border: none;
        border-radius: 4px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .btn-primary {
        background: var(--oak-dark);
        color: white;
    }
    
    .btn-primary:hover {
        background: var(--oak-mid);
    }
    
    .btn-danger {
        background: var(--danger);
        color: white;
    }
    
    .btn-danger:hover {
        background: var(--danger-dark);
    }
</style>