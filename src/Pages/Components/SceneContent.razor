@inherits SceneContentBase

@namespace Wayfarer.Pages.Components

@* ARCHITECTURAL PRINCIPLE: Screen components are rendered INSIDE GameScreen's game-container.
   They must NEVER define their own game-container, header, or resource bars - those are managed by the parent GameScreen.
   Screen components should only contain their specific content wrapped in a semantic class like 'scene-content'. *@

@if (Scene != null && CurrentSituation != null)
{
    <div class="scene-content">
        <!-- Scene Header -->
        <div class="scene-header">
            <h2 class="scene-title">@Scene.DisplayName</h2>
        </div>

        <!-- Narrative Section -->
        <div class="scene-narrative">
            @CurrentSituation.Description
        </div>

        <!-- Choices Section -->
        <div class="scene-choices">
            @if (Choices != null && Choices.Any())
            {
                @foreach (var choice in Choices)
                {
                    <div class="scene-choice-card action-card @(!choice.RequirementsMet ? "locked" : "")"
                         @onclick="() => HandleChoiceSelected(choice)">
                        @if (!choice.RequirementsMet && !string.IsNullOrEmpty(choice.LockReason))
                        {
                            <div class="action-locked-overlay">
                                <span class="lock-icon">üîí</span>
                                <span class="lock-text">@choice.LockReason</span>
                            </div>
                        }
                        <div class="choice-name">@choice.Name</div>
                        @if (!string.IsNullOrEmpty(choice.Description))
                        {
                            <div class="choice-description">@choice.Description</div>
                        }

                        @* ALL COSTS - Perfect Information *@
                        @if (choice.ResolveCost > 0 || choice.CoinsCost > 0 || choice.TimeSegments > 0 ||
                             choice.HealthCost > 0 || choice.StaminaCost > 0 || choice.FocusCost > 0 || choice.HungerCost > 0)
                        {
                            <div class="choice-section">
                                <div class="choice-section-title">COSTS:</div>
                                <div class="choice-costs">
                                    @if (choice.ResolveCost > 0)
                                    {
                                        <span class="cost">üéØ @choice.ResolveCost Resolve</span>
                                    }
                                    @if (choice.CoinsCost > 0)
                                    {
                                        <span class="cost">üí∞ @choice.CoinsCost Coins</span>
                                    }
                                    @if (choice.TimeSegments > 0)
                                    {
                                        <span class="cost">‚è±Ô∏è @choice.TimeSegments Segments</span>
                                    }
                                    @if (choice.HealthCost > 0)
                                    {
                                        <span class="cost">‚ù§Ô∏è @choice.HealthCost Health</span>
                                    }
                                    @if (choice.StaminaCost > 0)
                                    {
                                        <span class="cost">üí™ @choice.StaminaCost Stamina</span>
                                    }
                                    @if (choice.FocusCost > 0)
                                    {
                                        <span class="cost">üî∑ @choice.FocusCost Focus</span>
                                    }
                                    @if (choice.HungerCost > 0)
                                    {
                                        <span class="cost">üçΩÔ∏è +@choice.HungerCost Hunger</span>
                                    }
                                </div>
                            </div>
                        }

                        @* ALL CONSEQUENCES - Perfect Information *@
                        @if (choice.CoinsReward != 0 || choice.ResolveReward != 0 || choice.HealthReward != 0 ||
                             choice.StaminaReward != 0 || choice.FocusReward != 0 || choice.HungerChange != 0 ||
                             choice.FullRecovery || choice.BondChanges.Any() || choice.ScaleShifts.Any() ||
                             choice.StateApplications.Any() || choice.AchievementsGranted.Any() ||
                             choice.ItemsGranted.Any() || choice.LocationsUnlocked.Any() || choice.ScenesUnlocked.Any())
                        {
                            <div class="choice-section">
                                <div class="choice-section-title">CONSEQUENCES:</div>
                                <div class="choice-consequences">
                                    @* Resource rewards *@
                                    @if (choice.FullRecovery)
                                    {
                                        <div class="consequence-item">‚ú® Full Recovery (all resources restored)</div>
                                    }
                                    @if (choice.CoinsReward != 0)
                                    {
                                        <div class="consequence-item">üí∞ @(choice.CoinsReward > 0 ? "+" : "")@choice.CoinsReward Coins</div>
                                    }
                                    @if (choice.ResolveReward != 0)
                                    {
                                        <div class="consequence-item">üéØ @(choice.ResolveReward > 0 ? "+" : "")@choice.ResolveReward Resolve</div>
                                    }
                                    @if (choice.HealthReward != 0)
                                    {
                                        <div class="consequence-item">‚ù§Ô∏è @(choice.HealthReward > 0 ? "+" : "")@choice.HealthReward Health</div>
                                    }
                                    @if (choice.StaminaReward != 0)
                                    {
                                        <div class="consequence-item">üí™ @(choice.StaminaReward > 0 ? "+" : "")@choice.StaminaReward Stamina</div>
                                    }
                                    @if (choice.FocusReward != 0)
                                    {
                                        <div class="consequence-item">üî∑ @(choice.FocusReward > 0 ? "+" : "")@choice.FocusReward Focus</div>
                                    }
                                    @if (choice.HungerChange != 0)
                                    {
                                        <div class="consequence-item">üçΩÔ∏è @(choice.HungerChange > 0 ? "+" : "")@choice.HungerChange Hunger</div>
                                    }

                                    @* Relationship consequences *@
                                    @foreach (var bondChange in choice.BondChanges)
                                    {
                                        <div class="consequence-item consequence-bond">
                                            üíô @(bondChange.Delta > 0 ? "+" : "")@bondChange.Delta Bond with @bondChange.NpcName
                                            @if (!string.IsNullOrEmpty(bondChange.Reason))
                                            {
                                                <div class="consequence-reason">@bondChange.Reason</div>
                                            }
                                        </div>
                                    }

                                    @* Reputation consequences *@
                                    @foreach (var scaleShift in choice.ScaleShifts)
                                    {
                                        <div class="consequence-item consequence-scale">
                                            ‚öñÔ∏è @(scaleShift.Delta > 0 ? "+" : "")@scaleShift.Delta @scaleShift.ScaleName
                                            @if (!string.IsNullOrEmpty(scaleShift.Reason))
                                            {
                                                <div class="consequence-reason">@scaleShift.Reason</div>
                                            }
                                        </div>
                                    }

                                    @* Condition consequences *@
                                    @foreach (var stateApp in choice.StateApplications)
                                    {
                                        <div class="consequence-item consequence-state">
                                            @(stateApp.Apply ? "‚úÖ Gain" : "‚ùå Remove") State: @stateApp.StateName
                                            @if (!string.IsNullOrEmpty(stateApp.Reason))
                                            {
                                                <div class="consequence-reason">@stateApp.Reason</div>
                                            }
                                        </div>
                                    }

                                    @* Progression unlocks *@
                                    @if (choice.AchievementsGranted.Any())
                                    {
                                        <div class="consequence-item consequence-unlock">
                                            üèÜ Achievements: @string.Join(", ", choice.AchievementsGranted)
                                        </div>
                                    }
                                    @if (choice.ItemsGranted.Any())
                                    {
                                        <div class="consequence-item consequence-unlock">
                                            üéí Items: @string.Join(", ", choice.ItemsGranted)
                                        </div>
                                    }
                                    @if (choice.LocationsUnlocked.Any())
                                    {
                                        <div class="consequence-item consequence-unlock">
                                            üó∫Ô∏è Unlocks: @string.Join(", ", choice.LocationsUnlocked)
                                        </div>
                                    }
                                    @if (choice.ScenesUnlocked.Any())
                                    {
                                        <div class="consequence-item consequence-unlock">
                                            üìñ Unlocks Scenes: @string.Join(", ", choice.ScenesUnlocked)
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                }
            }
            else
            {
                <div class="no-choices-message">No choices available</div>
            }
        </div>
    </div>
}
else
{
    <div class="scene-error">
        <p>Scene or situation not found</p>
    </div>
}
