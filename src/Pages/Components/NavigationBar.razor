@using Wayfarer.UIHelpers
@using Wayfarer.Services

@inject NavigationService NavigationService
@inject GameWorld GameWorld

@namespace Wayfarer.Pages.Components

<div class="navigation-bar">
    <div class="nav-section nav-primary">
        <h4>Letter Management</h4>
        <div class="nav-buttons">
            <button class="nav-button @(IsActive(CurrentViews.LetterQueueScreen) ? "active" : "")" 
                    @onclick="() => NavigateTo(CurrentViews.LetterQueueScreen)">
                Queue
            </button>
            <button class="nav-button @(IsActive(CurrentViews.LetterBoardScreen) ? "active" : "")" 
                    @onclick="() => NavigateTo(CurrentViews.LetterBoardScreen)"
                    disabled="@(!CanNavigateToLetterBoard())">
                Board
            </button>
            <button class="nav-button @(IsActive(CurrentViews.RelationshipScreen) ? "active" : "")" 
                    @onclick="() => NavigateTo(CurrentViews.RelationshipScreen)">
                Relations
            </button>
            <button class="nav-button @(IsActive(CurrentViews.ObligationsScreen) ? "active" : "")" 
                    @onclick="() => NavigateTo(CurrentViews.ObligationsScreen)">
                Obligations
            </button>
        </div>
    </div>
    
    <div class="nav-section nav-secondary">
        <h4>World</h4>
        <div class="nav-buttons">
            <button class="nav-button @(IsActive(CurrentViews.LocationScreen) ? "active" : "")" 
                    @onclick="() => NavigateTo(CurrentViews.LocationScreen)">
                Location
            </button>
            <button class="nav-button @(IsActive(CurrentViews.MapScreen) ? "active" : "")" 
                    @onclick="() => NavigateTo(CurrentViews.MapScreen)">
                Map
            </button>
            <button class="nav-button @(IsActive(CurrentViews.TravelScreen) ? "active" : "")" 
                    @onclick="() => NavigateTo(CurrentViews.TravelScreen)">
                Travel
            </button>
            <button class="nav-button @(IsActive(CurrentViews.MarketScreen) ? "active" : "")" 
                    @onclick="() => NavigateTo(CurrentViews.MarketScreen)">
                Market
            </button>
            <button class="nav-button @(IsActive(CurrentViews.RestScreen) ? "active" : "")" 
                    @onclick="() => NavigateTo(CurrentViews.RestScreen)">
                Rest
            </button>
        </div>
    </div>
    
    <div class="nav-section nav-tertiary">
        <h4>Character</h4>
        <div class="nav-buttons">
            <button class="nav-button @(IsActive(CurrentViews.PlayerStatusScreen) ? "active" : "")" 
                    @onclick="() => NavigateTo(CurrentViews.PlayerStatusScreen)">
                Status
            </button>
        </div>
    </div>
    
    @if (NavigationService.CanNavigateBack())
    {
        <div class="nav-section nav-back">
            <button class="nav-button nav-back-button" @onclick="NavigateBack">
                ‚Üê Back
            </button>
        </div>
    }
</div>

@code {
    @implements IDisposable
    
    protected override void OnInitialized()
    {
        NavigationService.OnNavigationChanged += OnNavigationChanged;
    }
    
    private void OnNavigationChanged(CurrentViews newView)
    {
        InvokeAsync(StateHasChanged);
    }
    
    private void NavigateTo(CurrentViews view)
    {
        NavigationService.NavigateTo(view);
    }
    
    private void NavigateBack()
    {
        NavigationService.NavigateBack();
    }
    
    private bool IsActive(CurrentViews view)
    {
        return NavigationService.CurrentScreen == view;
    }
    
    private bool CanNavigateToLetterBoard()
    {
        return GameWorld.TimeManager.GetCurrentTimeBlock() == TimeBlocks.Dawn;
    }
    
    public void Dispose()
    {
        NavigationService.OnNavigationChanged -= OnNavigationChanged;
    }
}