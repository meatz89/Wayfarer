@namespace Wayfarer.Pages.Components
@*
Obligation Deadline Tracker - Shows countdown to deadline
Visual urgency indicator
*@

<div class="deadline-tracker @UrgencyClass">
    <div class="deadline-label">Deadline:</div>
    <div class="deadline-value">
        <span class="deadline-segment">Segment @DeadlineSegment</span>
        <span class="deadline-remaining">(@SegmentsRemaining left)</span>
    </div>
    <div class="deadline-bar">
        <div class="deadline-progress" style="width: @ProgressPercentage%;"></div>
    </div>
    @if (IsOverdue)
    {
        <div class="deadline-overdue">OVERDUE!</div>
    }
    else if (IsCritical)
    {
        <div class="deadline-warning">URGENT!</div>
    }
</div>

@code {
    [Parameter] public int DeadlineSegment { get; set; }
    [Parameter] public int CurrentSegment { get; set; }

    private int SegmentsRemaining => Math.Max(0, DeadlineSegment - CurrentSegment);
    private bool IsOverdue => CurrentSegment > DeadlineSegment;
    private bool IsCritical => SegmentsRemaining <= 2 && !IsOverdue;

    private string UrgencyClass
    {
        get
        {
            if (IsOverdue) return "deadline-overdue";
            if (SegmentsRemaining <= 2) return "deadline-critical";
            if (SegmentsRemaining <= 4) return "deadline-high";
            if (SegmentsRemaining <= 8) return "deadline-moderate";
            return "deadline-low";
        }
    }

    private double ProgressPercentage
    {
        get
        {
            // Assume starting at segment 1, deadline at segment X
            // Progress = how far through the time window we are
            double elapsed = CurrentSegment;
            double total = DeadlineSegment;
            return Math.Min(100, (elapsed / total) * 100);
        }
    }
}
