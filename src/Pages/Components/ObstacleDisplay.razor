@inherits ObstacleDisplayBase

@namespace Wayfarer.Pages.Components

@if (Obstacle != null)
{
    <div class="obstacle-card @GetSeverityClass()">
        <div class="obstacle-header">
            <div class="obstacle-name">@Obstacle.Name</div>
            @if (Obstacle.IsCleared())
            {
                <div class="obstacle-status cleared">Cleared</div>
            }
            else
            {
                <div class="obstacle-status active">Active</div>
            }
        </div>

        @if (!string.IsNullOrEmpty(Obstacle.Description))
        {
            <div class="obstacle-description">@Obstacle.Description</div>
        }

        @if (Obstacle.Contexts != null && Obstacle.Contexts.Any())
        {
            <div class="obstacle-contexts">
                <div class="contexts-label">Contexts:</div>
                <div class="contexts-tags">
                    @foreach (var context in Obstacle.Contexts)
                    {
                        <span class="context-tag">@context</span>
                    }
                </div>
            </div>
        }

        @if (MatchingEquipment != null && MatchingEquipment.Any())
        {
            <div class="obstacle-equipment-match">
                <div class="equipment-match-header">Equipment Reducing Intensity (-@EffectiveIntensity?.IntensityReduction):</div>
                @foreach (var match in MatchingEquipment)
                {
                    <div class="equipment-match-item">
                        <span class="equipment-name">@match.Equipment.Name</span>
                        <span class="equipment-contexts">[@string.Join(", ", match.MatchingContexts)]</span>
                        <span class="equipment-reduction">-@match.IntensityReduction</span>
                    </div>
                }
            </div>
        }

        <div class="obstacle-properties">
            <div class="section-subheader">Challenge Intensity @(EffectiveIntensity?.IntensityReduction > 0 ? "(Reduced)" : "")</div>

            <div class="property-row">
                <span class="property-label">Intensity:</span>
                @if (EffectiveIntensity?.IntensityReduction > 0 && EffectiveIntensity.EffectiveIntensity < Obstacle.Intensity)
                {
                    <span class="property-value-reduced">
                        <span class="base-value strikethrough">@Obstacle.Intensity</span>
                        <span class="effective-value @GetPropertyClass(EffectiveIntensity.EffectiveIntensity)">@EffectiveIntensity.EffectiveIntensity</span>
                    </span>
                }
                else
                {
                    <span class="property-value @GetPropertyClass(Obstacle.Intensity)">@Obstacle.Intensity / 3</span>
                }
            </div>
        </div>

        @if (Obstacle.IsPermanent)
        {
            <div class="obstacle-permanence">@GetPermanenceDisplay()</div>
        }

        @if (Obstacle.GoalIds != null && Obstacle.GoalIds.Any())
        {
            <div class="obstacle-goals-info">
                @Obstacle.GoalIds.Count approach(es) available
            </div>
        }
    </div>
}
