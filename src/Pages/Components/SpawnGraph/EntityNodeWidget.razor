@namespace Wayfarer.Pages.Components.SpawnGraph
@using Wayfarer.Pages.Components

<div class="spawn-node @GetNodeClass() @GetSelectedClass() @GetHighlightedClass()">
    <div class="node-header">
        <Icon Name="@GetIconName()" Size="14px" CssClass="node-icon" />
        <div class="node-badge">@GetBadgeText()</div>
        @if (Node.Resolution != null)
        {
            <div class="resolution-badge @GetResolutionClass()">@GetResolutionText()</div>
        }
    </div>
    <div class="node-label">@Node.EntityName</div>
    <div class="node-info">@GetInfoText()</div>
    @if (!string.IsNullOrEmpty(GetFilterPropertiesText()))
    {
        <div class="node-filter-props">@GetFilterPropertiesText()</div>
    }
</div>

@code {
    [Parameter] public EntityNodeModel Node { get; set; }

    private string GetNodeClass()
    {
        return Node.EntityType switch
        {
            SpawnGraphEntityType.Location => "location-node",
            SpawnGraphEntityType.NPC => "npc-node",
            SpawnGraphEntityType.Route => "route-node",
            _ => ""
        };
    }

    private string GetBadgeText()
    {
        return Node.EntityType switch
        {
            SpawnGraphEntityType.Location => "Location",
            SpawnGraphEntityType.NPC => "NPC",
            SpawnGraphEntityType.Route => "Route",
            _ => "Entity"
        };
    }

    private string GetInfoText()
    {
        return Node.EntityType switch
        {
            SpawnGraphEntityType.Location => Node.LocationSnapshot?.Purpose.ToString() ?? "",
            SpawnGraphEntityType.NPC => Node.NPCSnapshot?.Profession.ToString() ?? "",
            SpawnGraphEntityType.Route => Node.RouteSnapshot?.Method.ToString() ?? "",
            _ => ""
        };
    }

    private string GetSelectedClass()
    {
        return Node.Selected ? "selected" : "";
    }

    private string GetIconName()
    {
        return Node.EntityType switch
        {
            SpawnGraphEntityType.Location => "round-star",
            SpawnGraphEntityType.NPC => "crown",
            SpawnGraphEntityType.Route => "backpack",
            _ => "sparkles"
        };
    }

    private string GetHighlightedClass()
    {
        return Node.IsHighlighted ? "highlighted" : "";
    }

    private string GetResolutionText()
    {
        if (Node.Resolution == null) return "";

        return Node.Resolution.Outcome switch
        {
            EntityResolutionOutcome.Discovered => "Found",
            EntityResolutionOutcome.Created => "Created",
            EntityResolutionOutcome.RouteDestination => "Via Route",
            _ => ""
        };
    }

    private string GetResolutionClass()
    {
        if (Node.Resolution == null) return "";

        return Node.Resolution.Outcome switch
        {
            EntityResolutionOutcome.Discovered => "resolution-discovered",
            EntityResolutionOutcome.Created => "resolution-created",
            EntityResolutionOutcome.RouteDestination => "resolution-route-dest",
            _ => ""
        };
    }

    private string GetFilterPropertiesText()
    {
        if (Node.Resolution == null) return "";

        return Node.Resolution.Outcome switch
        {
            EntityResolutionOutcome.Discovered when Node.Resolution.MatchedProperties.Count > 0 =>
                string.Join(", ", Node.Resolution.MatchedProperties),
            EntityResolutionOutcome.Created when Node.Resolution.FilterProvidedProperties.Count > 0 =>
                string.Join(", ", Node.Resolution.FilterProvidedProperties),
            _ => ""
        };
    }
}
