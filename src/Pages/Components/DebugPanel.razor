@namespace Wayfarer.Pages.Components
@using Wayfarer.Pages.Components.SpawnTrace
@inject GameOrchestrator GameOrchestrator
@inject MessageSystem MessageSystem
@inject NavigationManager NavigationManager
@inject ProceduralContentTracer ProceduralTracer

<div class="debug-panel @(IsExpanded ? "expanded" : "collapsed")">
    <div class="debug-toggle" @onclick="TogglePanel">
        <span><span class="icon-tool"></span> Debug</span>
    </div>

    @if (IsExpanded)
    {
        <div class="debug-content">
            <h3>Debug Commands</h3>

            <!-- Stat Controls -->
            <div class="debug-section">
                <h4>Player Stats</h4>
                <div class="stat-controls">
                    @foreach (PlayerStatType statType in Enum.GetValues(typeof(PlayerStatType)))
                    {
                        <div class="stat-control">
                            <span class="stat-name">@statType:</span>
                            <button class="debug-btn" @onclick="() => SetStatLevel(statType, 1)">L1</button>
                            <button class="debug-btn" @onclick="() => SetStatLevel(statType, 2)">L2</button>
                            <button class="debug-btn" @onclick="() => SetStatLevel(statType, 3)">L3</button>
                            <button class="debug-btn" @onclick="() => SetStatLevel(statType, 4)">L4</button>
                            <button class="debug-btn" @onclick="() => SetStatLevel(statType, 5)">L5</button>
                            <button class="debug-btn xp" @onclick="() => AddStatXP(statType, 10)">+10 XP</button>
                        </div>
                    }
                </div>
                <div class="stat-bulk-controls">
                    <button class="debug-btn bulk" @onclick="() => SetAllStats(2)">All L2</button>
                    <button class="debug-btn bulk" @onclick="() => SetAllStats(3)">All L3</button>
                    <button class="debug-btn bulk" @onclick="() => SetAllStats(5)">All L5</button>
                    <button class="debug-btn info" @onclick="ShowStatInfo">Show Stats</button>
                </div>
            </div>

            <!-- Resource Controls -->
            <div class="debug-section">
                <h4>Resources</h4>
                <div class="resource-controls">
                    <button class="debug-btn" @onclick="() => GiveResources(10, 0, 0)">+10 Coins</button>
                    <button class="debug-btn" @onclick="() => GiveResources(50, 0, 0)">+50 Coins</button>
                    <button class="debug-btn" @onclick="() => GiveResources(0, 20, 0)">+20 Health</button>
                    <button class="debug-btn" @onclick="() => GiveResources(0, 100, 0)">Full Health</button>
                    <button class="debug-btn" @onclick="() => GiveResources(0, 0, -30)">-30 Hunger</button>
                    <button class="debug-btn" @onclick="() => GiveResources(0, 0, -100)">No Hunger</button>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="debug-section">
                <h4>Quick Actions</h4>
                <div class="quick-actions">
                    <button class="debug-btn" @onclick="RevealAllPaths">Reveal All Paths</button>
                    <button class="debug-btn" @onclick="UnlockAllTokens">Max All Tokens</button>
                    <button class="debug-btn" @onclick="SkipTime">Skip 1 Hour</button>
                    <button class="debug-btn" @onclick="TeleportToElena">Go to Elena</button>
                </div>
            </div>

            <!-- Spawn Trace Viewer -->
            <div class="debug-section">
                <h4>Procedural Content Trace</h4>
                <div class="spawn-trace-controls">
                    <button class="debug-btn" @onclick="OpenSpawnGraph">Open Full Graph</button>
                    <button class="debug-btn" @onclick="ToggleSpawnTrace">@(showSpawnTrace ? "Hide" : "Show") Tree</button>
                </div>
                @if (showSpawnTrace)
                {
                    <SpawnGraphViewer Tracer="@ProceduralTracer" />
                }
            </div>
        </div>
    }
</div>

@code {
    private bool IsExpanded = false;
    private bool showSpawnTrace = false;

    private void TogglePanel()
    {
        IsExpanded = !IsExpanded;
    }

    private void ToggleSpawnTrace()
    {
        showSpawnTrace = !showSpawnTrace;
        StateHasChanged();
    }

    private void OpenSpawnGraph()
    {
        NavigationManager.NavigateTo("/spawngraph");
    }

    private async Task SetStatLevel(PlayerStatType statType, int level)
    {
        await GameOrchestrator.DebugSetStatLevel(statType, level);
        StateHasChanged();
    }

    private async Task AddStatXP(PlayerStatType statType, int xp)
    {
        await GameOrchestrator.DebugAddStatXP(statType, xp);
        StateHasChanged();
    }

    private async Task SetAllStats(int level)
    {
        await GameOrchestrator.DebugSetAllStats(level);
        StateHasChanged();
    }

    private void ShowStatInfo()
    {
        string info = GameOrchestrator.DebugGetStatInfo();
        MessageSystem.AddSystemMessage(info, SystemMessageTypes.Info, null);
    }

    private async Task GiveResources(int coins, int health, int hunger)
    {
        await GameOrchestrator.DebugGiveResources(coins, health, hunger);
        StateHasChanged();
    }

    private void RevealAllPaths()
    {
        // This would need to be implemented in TravelFacade
        MessageSystem.AddSystemMessage("Path revelation not yet implemented", SystemMessageTypes.Warning, null);
    }

    private void UnlockAllTokens()
    {
        // This would need to be implemented in TokenFacade
        MessageSystem.AddSystemMessage("Token unlock not yet implemented", SystemMessageTypes.Warning, null);
    }

    private void SkipTime()
    {
        // This would need to be implemented in TimeFacade
        MessageSystem.AddSystemMessage("Time skip not yet implemented", SystemMessageTypes.Warning, null);
    }

    private void TeleportToElena()
    {
        GameOrchestrator.DebugTeleportToLocation("copper_kettle_tavern", "corner_table");
        StateHasChanged();
    }
}