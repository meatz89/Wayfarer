@* Maps Location orthogonal properties to descriptive text *@

@code {
    [Parameter] public Location CurrentLocation { get; set; }
    [Parameter] public TimeBlocks CurrentTime { get; set; }
    [Parameter] public List<NPC> NPCsPresent { get; set; }

    private string GetAtmosphereText()
    {
        if (CurrentLocation == null)
            return "An undefined location.";

        // Generate description from orthogonal categorical dimensions
        List<string> descriptors = new List<string>();

        // Purpose-based opening
        descriptors.Add(GetPurposeDescription(CurrentLocation.Purpose));

        // Activity level
        descriptors.Add(GetActivityDescription(CurrentLocation.Activity));

        // Environment
        descriptors.Add(GetEnvironmentDescription(CurrentLocation.Environment));

        // NPC presence
        int npcCount = NPCsPresent?.Count ?? 0;
        if (npcCount > 3)
            descriptors.Add("Several figures go about their business");
        else if (npcCount > 0)
            descriptors.Add("A few souls are present");

        return string.Join(". ", descriptors.Where(d => !string.IsNullOrEmpty(d))) + ".";
    }

    private string GetPurposeDescription(LocationPurpose purpose)
    {
        return purpose switch
        {
            LocationPurpose.Transit => "A passage point facilitating movement",
            LocationPurpose.Dwelling => "A living space offering lodging",
            LocationPurpose.Commerce => "A place of trade where business thrives",
            LocationPurpose.Civic => "An officially administered public space",
            LocationPurpose.Defense => "A militarily strategic position",
            LocationPurpose.Governance => "A bureaucratically organized area",
            LocationPurpose.Worship => "A sacred space devoted to spiritual matters",
            LocationPurpose.Learning => "A scholarly space dedicated to knowledge",
            LocationPurpose.Entertainment => "A place offering amusement and diversion",
            LocationPurpose.Generic => "A versatile space serving various purposes",
            _ => "A notable location"
        };
    }

    private string GetActivityDescription(LocationActivity activity)
    {
        return activity switch
        {
            LocationActivity.Quiet => "Peaceful silence pervades",
            LocationActivity.Moderate => "Typical activity fills the space",
            LocationActivity.Busy => "Bustling with people and activity",
            _ => ""
        };
    }

    private string GetEnvironmentDescription(LocationEnvironment environment)
    {
        return environment switch
        {
            LocationEnvironment.Indoor => "Sheltered from the elements",
            LocationEnvironment.Outdoor => "Open to the sky",
            LocationEnvironment.Covered => "Partially sheltered",
            LocationEnvironment.Underground => "Below ground level",
            _ => ""
        };
    }

    private string GetNPCFocusDescription(NPC npc)
    {
        var connectionState = DetermineConnectionState(npc);
        var baseActivity = GetProfessionActivity(npc.Profession);
        return $"{baseActivity}";
    }

    private ConnectionState DetermineConnectionState(NPC npc)
    {
        return ConnectionState.NEUTRAL;
    }

    private string GetProfessionActivity(Professions profession)
    {
        return profession switch
        {
            Professions.Scribe => "Hunched over documents",
            Professions.Merchant => "Arranging goods with practiced efficiency",
            Professions.Innkeeper => "Polishing glasses behind the bar",
            Professions.Soldier => "Standing at attention",
            Professions.Noble => "Reviewing correspondence",
            Professions.Scholar => "Studying texts intently",
            _ => "Going about their business"
        };
    }

    private string GetEmotionalModifier(ConnectionState state, bool hasUrgentLetter)
    {
        return state switch
        {
            ConnectionState.DISCONNECTED => "visibly distressed",
            ConnectionState.GUARDED => "occasionally glancing around nervously",
            ConnectionState.NEUTRAL => "focused on the task at hand",
            ConnectionState.RECEPTIVE => "with a welcoming demeanor",
            ConnectionState.TRUSTING => "radiating warmth and connection",
            _ => "focused on the task at hand"
        };
    }

    private string GetContextualProp(Professions profession, bool hasUrgentLetter)
    {
        if (hasUrgentLetter) return "a sealed letter";

        return profession switch
        {
            Professions.Scribe => "quill and parchment",
            Professions.Merchant => "ledger and scales",
            Professions.Innkeeper => "a well-worn mug",
            Professions.Soldier => "weapon at the ready",
            _ => "their tools"
        };
    }

    private string GetDisconnectedDetail()
    {
        return "eyes darting to the door with each patron's entrance";
    }

    private string? GetObservationHint()
    {
        if (CurrentLocation == null)
            return null;

        // Generate hints based on orthogonal properties
        if (CurrentLocation.Purpose == LocationPurpose.Commerce)
            return "Diplomacy flows visibly. Merchant patterns emerge.";

        if (CurrentLocation.Role == LocationRole.Connective || CurrentLocation.Role == LocationRole.Hub)
            return "Multiple paths of activity intersect here.";

        if (CurrentLocation.Purpose == LocationPurpose.Worship)
            return "Devotional patterns become apparent.";

        if (CurrentLocation.Activity == LocationActivity.Busy)
            return "Numerous interactions to observe in the bustle.";

        return null;
    }
}

<div class="atmosphere-section">
    <div class="atmosphere-section">
        @GetAtmosphereText()
    </div>

    @{
        var hint = GetObservationHint();
        if (!string.IsNullOrEmpty(hint))
        {
            <div class="observation-hint">
                <em>@hint</em>
            </div>
        }
    }
</div>
