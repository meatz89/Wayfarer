@inherits HexMapContentBase

@namespace Wayfarer.Pages.Components

<link href="css/hex-map.css" rel="stylesheet" />

<div class="hex-map-container">
    <!-- Map Header -->
    <div class="map-header">
        <div class="map-title">World Map</div>
        <button class="close-map-btn" @onclick="CloseMap">Close</button>
    </div>

    <!-- HTML/CSS Hex Grid -->
    <div class="map-viewport">
        <div class="hex-grid-container">
            @* First pass: Render venue labels (outside clip-path) *@
            @foreach (var hex in Hexes)
            {
                var pos = GetHexPosition(hex.Coordinates);
                var venue = GetVenueAtCoordinates(hex.Coordinates);
                var showVenueLabel = IsVenueLabelHex(hex.Coordinates);

                @if (showVenueLabel && venue != null)
                {
                    <div class="venue-label" style="left: @(pos.left + 35)px; top: @(pos.top - 10)px;">@venue.Name</div>
                }
            }

            @* Second pass: Render hexes *@
            @foreach (var hex in Hexes)
            {
                var pos = GetHexPosition(hex.Coordinates);
                var terrainClass = GetTerrainColorClass(hex);
                var isPlayer = IsPlayerPosition(hex.Coordinates);
                var location = GetLocationAtCoordinates(hex.Coordinates);
                var venue = GetVenueAtCoordinates(hex.Coordinates);
                var venueColorClass = GetVenueColorClass(venue);

                <div class="hex hex-@terrainClass @venueColorClass" style="left: @(pos.left)px; top: @(pos.top)px;">
                    @if (isPlayer)
                    {
                        <div class="player-marker">â˜…</div>
                    }
                    @if (location != null)
                    {
                        <div class="location-marker @(isPlayer ? "player-location" : "")">
                            @if (!isPlayer)
                            {
                                <div class="location-pin"></div>
                            }
                            <div class="location-name">@location.Name</div>
                        </div>
                    }
                </div>
            }
        </div>
    </div>

    <!-- Map Legend -->
    <div class="map-legend">
        <div class="legend-title">Terrain Types</div>
        <div class="legend-items">
            <div class="legend-item">
                <span class="legend-color hex-plains"></span>
                <span class="legend-label">Plains</span>
            </div>
            <div class="legend-item">
                <span class="legend-color hex-road"></span>
                <span class="legend-label">Road</span>
            </div>
            <div class="legend-item">
                <span class="legend-color hex-forest"></span>
                <span class="legend-label">Forest</span>
            </div>
            <div class="legend-item">
                <span class="legend-color hex-mountains"></span>
                <span class="legend-label">Mountains</span>
            </div>
            <div class="legend-item">
                <span class="legend-color hex-swamp"></span>
                <span class="legend-label">Swamp</span>
            </div>
            <div class="legend-item">
                <span class="legend-color hex-water"></span>
                <span class="legend-label">Water</span>
            </div>
            <div class="legend-item">
                <span class="legend-color player-marker-legend"></span>
                <span class="legend-label">Your Position</span>
            </div>
            <div class="legend-item">
                <span class="legend-color location-marker-legend"></span>
                <span class="legend-label">Location</span>
            </div>
        </div>
    </div>
</div>
