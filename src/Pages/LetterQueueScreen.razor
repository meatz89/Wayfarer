@page "/queue"
@inherits MainGameplayViewBase

<div class="main-container">
    <!-- Header -->
    <div class="header">
        <div class="time-bar">
            <span>@GetCurrentTime()</span>
            <span class="deadline-timer">@GetNextDeadline()</span>
        </div>
    </div>

    <!-- Location Header -->
    <div class="location-header">
        <div class="location-path">
            <span>@GetLocationPath()</span>
            <span>‚Üí</span>
            <span>@GetSpotPath()</span>
        </div>
        <div class="location-name">@GetCurrentSpotName()</div>
        <div class="location-tags">
            <span class="tag atmosphere">üî• Hearth-warmed</span>
            <span class="tag">üç∫ Ale-scented</span>
            <span class="tag">üéµ Music drifting</span>
        </div>
    </div>

    <div class="content-area">
        <div class="atmosphere-text">
            @GetAtmosphereText()
        </div>

        <!-- Letter Queue Section -->
        <div class="letter-queue-section">
            <h3 class="section-header">üì¨ Letter Queue</h3>
            <div class="letter-grid">
                @for (int i = 0; i < 8; i++)
                {
                    var letter = GetLetterAtPosition(i + 1);
                    <div class="letter-slot @(letter != null ? "occupied" : "empty") @(i == 0 ? "deliverable" : "")">
                        <div class="slot-number">@(i + 1)</div>
                        @if (letter != null)
                        {
                            <div class="letter-content">
                                <div class="letter-route">
                                    <span class="sender">@letter.SenderName</span>
                                    <span class="arrow">‚Üí</span>
                                    <span class="recipient">@letter.RecipientName</span>
                                </div>
                                <div class="letter-desc">@letter.Description</div>
                                <div class="letter-meta">
                                    <span class="stakes @GetStakesClass(letter.Stakes)">@GetStakesDisplay(letter.Stakes)</span>
                                    <span class="deadline">@GetDeadlineDisplay(letter)</span>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="empty-slot">Empty</div>
                        }
                    </div>
                }
            </div>
        </div>

        <!-- Dynamic NPCs at Current Location -->
        @{
            var npcsHere = GetNPCsAtCurrentSpot();
            if (npcsHere != null && npcsHere.Any())
            {
                foreach (var npc in npcsHere)
                {
                    <div class="npc-present">
                        <div class="npc-header">
                            <div>
                                <div class="npc-name">@npc.Name</div>
                            </div>
                            <div class="npc-mood">@GetNPCMood(npc)</div>
                        </div>
                        <div class="npc-description">
                            @GetNPCDescription(npc)
                        </div>
                        <div class="interaction-options">
                            <div class="interaction" @onclick="@(() => StartConversation(npc.ID))">
                                <span>@GetInteractionText(npc)</span>
                                <span class="interaction-cost">@GetInteractionCost(npc)</span>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="no-npcs">
                    <p>The location is quiet. No one is here at the moment.</p>
                </div>
            }
        }
    </div>
</div>