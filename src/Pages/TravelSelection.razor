 @inherits TravelSelectionBase

@inject GameWorldManager GameManager
@inject TravelManager TravelManager

<div class="world-map-container">
    <div class="travel-status">
        @{
            int totalWeight1 = GameManager.CalculateTotalWeight();
            string weightClass = totalWeight1 <= 3 ? "" :
            (totalWeight1 <= 6 ? "warning" : "danger");
            string weightStatus = totalWeight1 <= 3 ? "Light load" :
            (totalWeight1 <= 6 ? "Medium load (+1 stamina)" :
            "Heavy load (+2 stamina)");
            int coinWeight = GameWorld.GetPlayer().Coins / 10;
        }
        <div class="weight-status @weightClass">
            <span>Current load: @weightStatus (@totalWeight1 weight units)</span>
        </div>
        <div class="resource-status">
            <span>Coins: @GameWorld.GetPlayer().Coins <span class="coin-weight">(@coinWeight weight)</span></span>
            <span>Stamina: @GameWorld.GetPlayer().Stamina</span>
        </div>
    </div>

    <div class="locations-grid">
        @foreach (var location in GetTravelableLocations())
        {
            <div class="location-card">
                <div class="location-name">
                    @location.Name @(location.Id == CurrentLocation.Id ? "(Current)" : "")
                </div>
                <div class="location-routes">
                    @{
                        var routeComparisons = TravelManager.GetRouteComparisonData(CurrentLocation.Id, location.Id);
                        var recommendation = routeComparisons.Count > 0 ? 
                            TravelManager.GetOptimalRouteRecommendation(CurrentLocation.Id, location.Id, OptimizationStrategy.Efficiency) : null;
                    }
                    
                    @if (recommendation != null)
                    {
                        <div class="route-recommendation">
                            <strong>Recommended:</strong> @recommendation.RecommendedRoute.Name - @recommendation.Justification
                        </div>
                    }
                    
                    @foreach (var comparison in routeComparisons)
                    {
                        <div class="route-option @(!comparison.CanAfford ? "disabled" : "") @(recommendation?.RecommendedRoute == comparison.Route ? "recommended" : "")">
                            <div class="route-header">
                                <div class="route-name">
                                    @comparison.Route.Name
                                    @if (recommendation?.RecommendedRoute == comparison.Route)
                                    {
                                        <span class="recommended-badge">★ Recommended</span>
                                    }
                                </div>
                                <div class="efficiency-score">
                                    Efficiency: @comparison.EfficiencyScore.ToString("F1")/5
                                </div>
                            </div>
                            <div class="route-details">
                                <div class="cost-breakdown">
                                    <span>@comparison.Route.BaseCoinCost coins</span>
                                    <span>@comparison.AdjustedStaminaCost stamina @(comparison.WeightPenalty > 0 ? $"(+{comparison.WeightPenalty} weight penalty)" : "")</span>
                                    <span>Arrives: @comparison.ArrivalTime</span>
                                </div>
                                <div class="analysis">
                                    <div class="cost-benefit">@comparison.CostBenefitAnalysis</div>
                                    <div class="recommendation-text">@comparison.Recommendation</div>
                                </div>
                                @if (comparison.Route.DepartureTime.HasValue)
                                {
                                    <span>Departs: @comparison.Route.DepartureTime</span>
                                }
                                @if (comparison.Route.RequiredRouteTypes.Any())
                                {
                                    <span>Requires: @string.Join(", ", comparison.Route.RequiredRouteTypes)</span>
                                }
                                <span>Max items: @comparison.Route.MaxItemCapacity</span>
                            </div>
                            <button class="travel-button"
                                    disabled="@(!comparison.CanAfford)"
                                    @onclick="() => OnTravelRoute.InvokeAsync(comparison.Route)">
                                Travel
                            </button>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
</div>