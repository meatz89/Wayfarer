@inherits LocationSpotMapBase

@* LocationSpotMap.razor *@

<div class="locations-grid">
    @foreach (LocationSpot spot in GetKnownSpots())
    {
        <div class="@(!spot.IsClosed ? "enabled" : "disabled")">

            <div class="location-card @(spot.SpotID == CurrentSpot.SpotID ? "current" : "reachable")">
                <div class="location-spot-properties">
                    @foreach (var prop in StyleHelper.GetSpotProperties(GetLocation(), spot))
                    {
                        <div class="property-tag @prop.CssClass">
                            <span class="property-icon">@prop.Icon</span>
                            <span class="property-text">@prop.Text</span>
                        </div>
                    }
                </div>
                <div class="location-name">
                    @spot.Name @(spot.IsClosed ? "(Closed)" : "")
                </div>
                <div class="location-type">@spot.Description</div>

                @* NPC Schedule Display *@
                @{
                    var npcsAtSpot = GetAllNPCsForSpot(spot);
                    if (npcsAtSpot.Any())
                    {
                        <div class="npc-schedule-section">
                            <div class="npc-schedule-header">People at this location</div>
                            <div class="npc-list">
                                @foreach (var npc in npcsAtSpot)
                                {
                                    var isAvailable = IsNPCCurrentlyAvailable(npc);
                                    var nextAvailable = GetNextAvailableTime(npc);
                                    
                                    <div class="npc-item">
                                        <div class="npc-basic-info">
                                            <div class="npc-name-small">@npc.Name</div>
                                            <div class="npc-services">
                                                @foreach (var service in npc.ProvidedServices.Take(3))
                                                {
                                                    <span class="service-icon" title="@service.ToString().Replace('_', ' ')">@GetServiceIcon(service)</span>
                                                }
                                                @if (npc.ProvidedServices.Count > 3)
                                                {
                                                    <span class="service-more">+@(npc.ProvidedServices.Count - 3) more</span>
                                                }
                                            </div>
                                        </div>
                                        <div class="npc-availability-info">
                                            <div class="npc-status">
                                                <span class="availability-dot @(isAvailable ? "available" : "unavailable")"></span>
                                                <span>@(isAvailable ? "Available" : "Unavailable")</span>
                                            </div>
                                            @if (!isAvailable)
                                            {
                                                <div class="npc-schedule-times">@nextAvailable</div>
                                            }
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    }
                }

        @if (spot.SpotID == CurrentSpot.SpotID)
        {
            @* Actions removed - using LocationActionManager and letter queue system *@
                }
                else
                {
                    @* Add travel option if not current spot *@
                    <button class="action-button" disabled="@(spot.IsClosed)"
                            @onclick="() => OnSpotSelected.InvokeAsync(spot)">
                        MOVE HERE
                    </button>
                }
            </div>
        </div>
    }
</div>

@namespace Wayfarer.Pages

@* Action preview removed - location actions handled by LocationActionManager *@
