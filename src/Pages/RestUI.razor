@* RestUI.razor *@
@inject GameWorld GameWorld
@inject GameWorldManager GameManager
@inject RestManager RestManager

<div class="rest-options">
    <div class="rest-option">
        <div class="option-header">
            <span class="option-name">Camp Outside</span>
            <span class="option-cost">Free</span>
        </div>
        <div class="option-benefits">
            <div class="benefit">
                <span class="benefit-label">Stamina Recovery:</span>
                <span class="benefit-value">+2</span>
            </div>
            <div class="benefit special-benefit">
                <span class="benefit-label">Special:</span>
                <span class="benefit-value">Enables dawn departure</span>
            </div>
        </div>
        <button class="rest-button" @onclick='() => Rest("camp")'>
            Rest Here
        </button>
    </div>

    <div class="rest-option">
        <div class="option-header">
            <span class="option-name">Inn Room</span>
            <span class="option-cost">2 coins</span>
        </div>
        <div class="option-benefits">
            <div class="benefit">
                <span class="benefit-label">Stamina Recovery:</span>
                <span class="benefit-value">+4</span>
            </div>
            <div class="benefit special-benefit">
                <span class="benefit-label">Special:</span>
                <span class="benefit-value">Provides market rumors</span>
            </div>
        </div>
        <button class="rest-button"
                disabled="@(GameWorld.GetPlayer().Coins < 2)"
                @onclick='() => Rest("inn")'>
            Rest Here
        </button>
    </div>
    
    <div class="wait-section">
        <h4>Wait</h4>
        <p>Current Time: @GameWorld.TimeManager.CurrentTimeHours:00 (@GameWorld.TimeManager.GetCurrentTimeBlock())</p>
        <p>Remaining Hours Today: @(24 - GameWorld.TimeManager.CurrentTimeHours)</p>
        
        <div class="wait-options">
            <button class="btn btn-outline-secondary btn-sm" 
                    disabled="@(GameWorld.TimeManager.CurrentTimeHours >= 23)"
                    @onclick="() => WaitHours(1)">
                Wait 1 Hour
            </button>
            <button class="btn btn-outline-secondary btn-sm" 
                    disabled="@(GameWorld.TimeManager.CurrentTimeHours >= 22)"
                    @onclick="() => WaitHours(2)">
                Wait 2 Hours  
            </button>
            <button class="btn btn-outline-secondary btn-sm" 
                    disabled="@(GameWorld.TimeManager.CurrentTimeHours >= 21)"
                    @onclick="() => WaitHours(3)">
                Wait 3 Hours
            </button>
        </div>
    </div>
</div>

@code {

@namespace Wayfarer.Pages
    [Parameter] public Location Location { get; set; }
    [Parameter] public EventCallback OnRestComplete { get; set; }

    private async Task Rest(string option)
    {
        // Use RestManager for proper architecture
        var availableOptions = RestManager.GetAvailableRestOptions();
        var selectedOption = availableOptions.FirstOrDefault(o => o.Id == option);
        
        if (selectedOption != null)
        {
            RestManager.Rest(selectedOption);
        }

        await OnRestComplete.InvokeAsync();
    }
    
    private async Task WaitHours(int hours)
    {
        RestManager.Wait(hours);
        await OnRestComplete.InvokeAsync();
    }
}