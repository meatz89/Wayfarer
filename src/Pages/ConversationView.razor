@inherits ConversationViewBase

@using Microsoft.AspNetCore.Components.Web

@namespace Wayfarer.Pages

<div class="encounter-container">
    <div class="encounter-content">
        <div class="encounter-main">
            <div class="encounter-stage">
                @if (ConversationManager != null && ConversationManager.State != null)
                {
                    <div class="stage-situation">@ConversationManager.State.CurrentNarrative</div>
                }
                else
                {
                    <div class="stage-situation">Starting conversation...</div>
                }
            </div>

            <div class="encounter-choices">
                @if (ConversationManager != null && ConversationManager.Choices?.Any() == true && !ConversationManager.IsAwaitingResponse)
                {
                    @foreach (var choice in ConversationManager.Choices)
                    {
                        <div class="choice-option"
                             @onclick="(() => MakeChoice(choice.ChoiceID))"
                             @onmouseover="(e => ShowTooltip(e, choice))"
                             @onmouseout="HideTooltip">
                            <div class="choice-index">@choice.ChoiceID</div>
                            <div class="choice-name">@choice.NarrativeText</div>
                        </div>
                    }

                    @if (showTooltip && hoveredChoice != null)
                    {
                        <ConversationChoiceTooltip hoveredChoice="hoveredChoice" tooltipX="tooltipX" tooltipY="tooltipY" />
                    }
                }
            </div>
            @if (ConversationManager?.IsAwaitingResponse == true)
            {
                <div class="loading-indicator">
                    Thinking...
                </div>
            }
        </div>
    </div>

    @if (ConversationManager?.State?.IsConversationComplete == true)
    {
        <div class="conversation-complete">
            <button class="nav-button" @onclick="CompleteConversation">Continue</button>
        </div>
    }

</div>