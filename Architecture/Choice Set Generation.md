**A System of Interlocking Parts: Locations, Actions, Encounters, and Choices**

This game is built on a foundation of interconnected systems designed to create elegant, deterministic encounters that offer meaningful choices to the player. The core loop revolves around exploring **Locations**, engaging in **Actions**, and navigating the resulting **Encounters** through a series of carefully crafted **Choices**.

**1. Locations: The Foundation of Gameplay**

Locations are not just scenic backdrops but are defined by a set of mechanical properties represented as enums:

*   **LocationArchetype:** (e.g., Tavern, Market, Library, Docks, Workshop) - Dictates the general nature of the location.
*   **CrowdLevel:** (e.g., Empty, Busy, Crowded) - Represents the density of people.
*   **LocationScale:** (e.g., Small, Medium, Large) - Indicates the physical size of the location.

These properties are crucial in determining the available actions and the types of encounters that can occur. The narrative content of locations like their names and descriptions is generated by AI and does not influence the mechanics.

**2. Actions: Initiating Encounters**

Each **Location Spot** within a Location offers a set of **Basic Actions** determined by its properties. Examples include:

*   **Labor:** (e.g., Load Cargo, Serve Drinks, Craft Item)
*   **Investigate:** (e.g., Gather Information, Search for Clues, Analyze Evidence)
*   **Discuss:** (e.g., Negotiate, Persuade, Learn)
*   **Mingle:** (e.g., Build Reputation, Gather Rumors, Make Connections)

When a player selects a Basic Action, an **Encounter** is initiated.

**3. Encounters: Dynamic and Deterministic**

Encounters are multi-stage events driven by an **Encounter Context** that tracks four key narrative values:

*   **Outcome:** (0-10) - Progress towards success.
*   **Pressure:** (0-10) - Mounting tension or difficulty.
*   **Insight:** (0-10) - Player's understanding of the situation.
*   **Resonance:** (0-10) - Player's social standing or influence within the encounter.

These values are integers and are initially set based on the chosen action, location properties, and player state.

**4. Encounter Stages: A Cycle of Choice and Consequence**

Each encounter unfolds in stages, each following a deterministic process:

    **a. Context Assessment:** The system evaluates:
        *   **Location Properties**
        *   **Encounter Context** (Outcome, Pressure, Insight, Resonance)
        *   **Player State** (Energy Levels, Skills, Reputation, Items, Knowledge)

    **b. Choice Set Selection:** The system deterministically selects the most appropriate **Choice Set Template** from a predefined pool based on the current context. Each choice set is designed to offer varied approaches to the situation and, crucially, to modify the encounter context in such a way that each subsequent stage will necessitate a *different* choice set.

    **c. Choice Set Instantiation:** The selected template is customized based on the context:
        *   **Energy Costs** are adjusted.
        *   **Rewards** are tailored.
        *   **Encounter Value Changes** are fine-tuned.

    **d. Choice Presentation:** The player is presented with 3-4 choices, each defined by two core properties:
        * Choice Archetype (Physical, Focus, Social):
            - Determines energy type consumed
            - Defines possible requirements:
                - Physical: Strength skills, tools/weapons
                - Focus: Observation skills, knowledge flags
                - Social: Charisma skills, reputation/relations
            - Defines possible rewards/costs:
                - Physical: Coins/reputation gain, health loss
                - Focus: Knowledge/items gain, stress increase
                - Social: Relations/skills gain, reputation loss

        * Approach (Aggressive, Careful, Strategic, Desperate):
            - Dictates encounter value changes:
                - Aggressive: High risk/reward (+2/+3 Outcome, +1/+2 Pressure)
                - Careful: Balanced (+1 Outcome, -1 Pressure)
                - Strategic: Long-term (+2 Insight/Resonance, no immediate Outcome)
                - Desperate: Fallback (+1 Outcome, +2 Pressure)
            - Determines requirements:
                - Desperate never has requirements (fallback option)
                - Other approaches may have requirements based on difficulty
                - Maximum two choices with requirements per set
            - Higher difficulty encounters have more requirements

 *   **Basic vs Strategic vs Special:** Each choice set will contain 1-2 Basic choices, 0-1 Strategic choices and 0-1 Special choices, adding another layer of strategic depth.

    **e. Player Choice and Consequence:**
        *   The player selects a choice.
        *   Energy is expended.
        *   Rewards are granted.
        *   Encounter context values are updated.

    **f. Loop or End:**
        *   If the encounter hasn't reached a success or failure state, the process repeats from Step 4a, using the updated context to select a new choice set.
        *   If the encounter has ended, the player experiences the consequences.

**Key Design Goals and Their Implementation:**

*   **Deterministic Outcomes:** The same context will always produce the same choices, ensuring predictability and allowing players to learn the system's mechanics.
*   **3-4 Choices per Stage:** Maintains a manageable decision space while offering meaningful options.
*   **Elegant Rather than Complex:** The system is built on a few core mechanics that interact in sophisticated ways, avoiding unnecessary complexity.
*   **Strong Verisimilitude:** Location properties, action types, and choice consequences are designed to feel logically consistent with the game world.
*   **Choices Reflect Mounting Pressure and Strain:** The Pressure value and the availability of energy resources create a sense of urgency and force players to make difficult decisions.
*   **Clear Impact of Player's Insight and Social Standing:** Insight and Resonance values directly influence the available choices and their effectiveness, emphasizing the importance of knowledge and social connections.

**5. Choice Set Generation: A Deeper Dive**

The process of generating choices deserves further elaboration:

1.  **Player Movement:** The player navigates to a specific Location Spot.
2.  **Action Selection:** The player chooses an available Basic Action, initiating an Encounter.
3.  **Encounter Initiation:** The Encounter begins, with initial Encounter Context values determined by the action, location, and player state.
4.  **Stage Generation (Repeated for each stage):**

    *   **Context Assessment:** The system thoroughly analyzes the Location Properties, Encounter Context, and Player State.
    *   **Choice Set Selection:** Based on this assessment, the system selects the most fitting Choice Set Template. This selection is deterministic â€“ identical contexts will yield identical choice sets. Each choice set is meticulously designed to ensure that the choices within it will modify the Encounter Context in a way that necessitates the selection of a *different* choice set in the subsequent stage.
    *   **Choice Set Instantiation:** The chosen template is then instantiated, becoming a concrete set of choices. This involves:
        *   **Energy Cost Adjustment:** Modifying the energy costs based on player stats or location properties.
        *   **Reward Tailoring:** Customizing rewards to the specific situation (e.g., awarding specific Knowledge or Item rewards).
        *   **Encounter Value Fine-tuning:** Adjusting the precise impact of choices on Outcome, Pressure, Insight, and Resonance.
    *   **Choice Presentation:** The player is presented with 3-4 choices, each fully defined by its Archetype, Approach, Energy Cost, Encounter Value Changes, Requirements (if any), and Rewards (if any).

5.  **Player Choice and Consequence:** The player makes their choice, leading to:

    *   Deduction of associated Energy Costs.
    *   Granting of any earned Rewards.
    *   Updating of Encounter Context Values based on the chosen action.

6.  **Loop or Encounter End:**

    *   If the Encounter hasn't reached a success or failure state, the process returns to Step 4 (Stage Generation) for the next stage. The modified context will result in a different choice set being selected, ensuring variety.
    *   If the Encounter has reached a conclusive state, it ends, and the player faces the consequences of their choices.

**Implications for Choice Set Design:**

*   **Diversity is Paramount:** A large and varied pool of Choice Set Templates is needed to ensure a wide range of experiences across different location/context combinations. This also includes multiple encounters at the same location using the same action type but with different starting and evolving contexts.
*   **Context Sensitivity:** Templates must be designed with specific requirements regarding Location Properties, Encounter Context, and Player State to ensure they are selected appropriately.
*   **Dynamic Adjustment:** The instantiation process must be flexible enough to adjust costs, rewards, and value changes effectively based on the specific circumstances of each encounter.

**Example: Choice Set Selection in Action**

Let's revisit the **INVESTIGATE** action at a **MARKET (Busy, Large)**:

*   **Initial Encounter Context:**
    *   Outcome: 2
    *   Pressure: 3
    *   Insight: 1
    *   Resonance: 2

The system might select a choice set template like "Market Investigation - Initial Lead" because it aligns with the action type, location properties, and the low initial Insight value.

**Stage 1 Choices (Illustrative):**

*   "Question Merchant" (Social - Careful, Basic): Costs 2 Social, increases Insight by +1, decreases Pressure -1, requires Reputation 5, Reward: Gives Clue
*   "Observe Crowd" (Focus - Careful, Basic): Costs 2 Focus, increases Insight by +2, decreases Pressure -1
*   "Inspect Stalls" (Physical - Desperate, Basic): Costs 3 Physical, increases Insight by +1, increases Pressure +2

If the player chooses "Observe Crowd," the context changes:

*   **Updated Encounter Context:**
    *   Outcome: 2
    *   Pressure: 2
    *   Insight: 3
    *   Resonance: 2
    *   Focus Energy: -2

For Stage 2, the system would select a *different* choice set, perhaps "Market Investigation - Following Up," due to the increased Insight, the reduced Focus Energy, and the still-relevant location and action type.

**6. Energy and Pressure Mechanics**

The energy system interacts intimately with mounting pressure. While each choice's base energy cost is determined by its archetype, these costs increase as pressure builds. Under normal circumstances (pressure 0-5), choices cost their base amount. As pressure mounts (6-8), every choice costs one additional energy point. In extremely tense situations (pressure 9-10), choices cost two additional energy points. This creates a natural escalation where continuing to push forward becomes increasingly costly. When a particular energy type is depleted, choices requiring that energy instead cost permanent resources - health for physical, stress for focus, and reputation for social.

- **Energy Costs:**
  - Base cost determined by Choice Archetype
  - Modified by Pressure level:
    - Pressure above 5: +1 to energy cost for each additional point of Pressure

- **Energy Depletion:**
  - Physical Energy (0): Choices cost 1 Health
  - Focus Energy (0): Choices cost 1 Stress
  - Social Energy (0): Choices cost 1 Reputation

- **Pressure Impact:**
  - Influences choice availability
  - Affects energy costs
  - Creates urgency through increasing costs

**7. Choice Set Pool Organization**

Choice sets are organized into distinct pools based on action types, with each pool containing multiple templates tailored to different situations. Labor actions draw primarily from templates featuring physical choices, investigation actions favor focus choices, while social interactions emphasize social choices. However, each pool maintains some variety to ensure players always have options. The specific choice set selected depends on multiple factors: the action type determines the initial pool, location properties filter the available templates, and the current encounter context guides the final selection.

- **Pool Structure:**
  - Separate pools for each Action Type
  - Each pool contains multiple Choice Set Templates
  - Templates are tagged with required Location Properties

- **Choice Set Bias:**
  - Labor: Primarily Physical choices
  - Investigate: Primarily Focus choices
  - Discuss: Mix of Focus and Social choices
  - Mingle: Primarily Social choices

- **Selection Criteria:**
  - Action Type determines initial pool
  - Location Properties filter available templates
  - Encounter Context determines final selection
  - Current Energy levels influence selection

- **Context Sensitivity:**
  - High Pressure favors Careful approaches
  - Low Energy favors approaches matching remaining energy types
  - High Insight/Resonance enables more Strategic approaches

**8. Requirements System**

Requirements appear more frequently in higher difficulty encounters. Low difficulty encounters (1-3) generally avoid requirements, medium difficulty (4-6) might include one required choice, while high difficulty encounters (7-10) often feature two choices with requirements. These requirements always match their choice's archetype - physical choices might require strength skills or specific tools, focus choices might need certain knowledge or observation abilities, and social choices could require specific reputation levels or relationship standings. Importantly, the Desperate approach never has requirements, ensuring players always have at least one available option.
This interlocking system creates a rich decision space where players must consider not just the immediate effects of their choices, but also their current resources, capabilities, and the mounting pressure of the situation. The deterministic nature of the system ensures that players can learn and master its mechanics while the variety of choice sets and the dynamic pressure system maintains engagement and challenge.

- **Requirement Distribution:**
  - Maximum two requirements per choice set
  - Desperate approach never has requirements
  - Requirements tied to Choice Archetype

- **Difficulty Scaling:**
  - Low Difficulty (1-3): No requirements
  - Medium Difficulty (4-6): One requirement possible
  - High Difficulty (7-10): Two requirements possible

- **Requirement Types:**
  - Must match Choice Archetype
  - Scale with difficulty level
  - Always provide alternative choices

**Conclusion**

This system, with its intricate interplay of Locations, Actions, Encounters, and Choices, creates a dynamic and engaging gameplay experience. It's deterministic, ensuring predictability and allowing players to master its mechanics, yet it feels dynamic and responsive due to the variety of choice sets and the context-sensitive instantiation. The player's choices have a tangible impact on the unfolding narrative, creating a sense of agency within a structured and elegant framework. The AI's role in generating narrative content further enhances the immersive quality of the game, making each playthrough a unique and compelling experience. This system, by achieving a balance between determinism, dynamism, and player agency, delivers on its core design goals of elegance, verisimilitude, and meaningful choice.

This creates a really elegant system where each choice has two core properties that determine its behavior:

1. Choice Archetype (Physical, Focus, Social):
- Determines energy type consumed
- Defines possible requirements:
    - Physical: Strength skills, tools/weapons
    - Focus: Observation skills, knowledge flags
    - Social: Charisma skills, reputation/relations
- Defines possible rewards/costs:
    - Physical: Coins/reputation gain, health loss
    - Focus: Knowledge/items gain, stress increase 
    - Social: Relations/skills gain, reputation loss

2. Approach (Aggressive, Careful, Strategic, Desperate):
- Dictates encounter value changes:
    - Aggressive: High risk/reward (+2/+3 Outcome, +1/+2 Pressure)
    - Careful: Balanced (+1 Outcome, -1 Pressure)  
    - Strategic: Long-term (+2 Insight/Resonance, no immediate Outcome)
    - Desperate: Fallback (+1 Outcome, +2 Pressure)
- Determines requirements:
    - Desperate never has requirements (fallback option)
    - Other approaches may have requirements based on difficulty
    - Maximum two choices with requirements per set
- Higher difficulty encounters have more requirements