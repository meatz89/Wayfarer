# Wayfarer POC - Actionable Implementation Tasks

*Generated by Claude Code on 2025-07-08*

## Immediate Priority Tasks (Week 1)

### ðŸ”¥ Critical: Time Block Constraint Enforcement

#### Task 1.1: Add Daily Time Block Limit
**File:** `src/GameState/TimeManager.cs`
**Estimated Time:** 4 hours

```csharp
// Add these constants and properties
public const int MAX_DAILY_TIME_BLOCKS = 5;
private int usedTimeBlocks = 0;

// Add constraint checking method
public bool CanPerformAction()
{
    return usedTimeBlocks < MAX_DAILY_TIME_BLOCKS;
}

// Modify AdvanceTime to track usage
public void AdvanceTime(int duration)
{
    if (usedTimeBlocks + duration > MAX_DAILY_TIME_BLOCKS)
    {
        throw new InvalidOperationException("Cannot exceed daily time block limit");
    }
    usedTimeBlocks += duration;
    SetNewTime(CurrentTimeHours + duration);
}

// Reset on new day
public void StartNewDay()
{
    usedTimeBlocks = 0;
    worldState.CurrentDay++;
    SetNewTime(TimeDayStart);
}
```

**Acceptance Criteria:**
- [ ] Players cannot perform more than 5 major actions per day
- [ ] UI shows remaining time blocks
- [ ] Actions are blocked when limit reached
- [ ] Counter resets at start of new day

#### Task 1.2: Update Action Processing
**File:** `src/Game/ProgressionSystems/ActionProcessor.cs`
**Estimated Time:** 2 hours

```csharp
// Modify ProcessAction to check time constraints
public bool CanProcessAction(LocationAction action)
{
    return gameWorld.TimeManager.CanPerformAction();
}

public void ProcessAction(LocationAction action)
{
    if (!CanProcessAction(action))
    {
        throw new InvalidOperationException("No time blocks remaining");
    }
    
    Player player = gameWorld.GetPlayer();
    player.ApplyActionPointCost(action.ActionPointCost);
    gameWorld.TimeManager.AdvanceTime(action.TimeBlockCost);
}
```

#### Task 1.3: Update UI Components
**Files:** `src/Pages/MainGameplayView.razor`, `src/Pages/ActionPreview.razor`
**Estimated Time:** 3 hours

- Add time block display to main UI
- Show remaining blocks prominently
- Disable action buttons when blocks exhausted
- Add visual indicators for time pressure

### ðŸ”§ Essential: Inventory Constraint Adjustment

#### Task 2.1: Reduce Inventory Slots
**File:** `src/GameState/Player.cs:166`
**Estimated Time:** 30 minutes

```csharp
// Change default inventory size
public Player()
{
    Background = GameRules.StandardRuleset.Background;
    Inventory = new Inventory(6); // Changed from 10 to 6
    // ... rest of constructor
}
```

**Testing Required:**
- [ ] Verify 6-slot limit creates strategic pressure
- [ ] Test item management scenarios
- [ ] Ensure UI updates correctly

#### Task 2.2: Adjust Stamina Pool
**File:** `src/GameState/Player.cs:25`
**Estimated Time:** 15 minutes

```csharp
// Reduce maximum stamina
public int MaxStamina { get; set; } = 6; // Changed from 12 to 6
```

---

## High Priority Tasks (Week 2)

### ðŸ’° Trading System Enhancement

#### Task 3.1: Implement Dynamic Pricing
**File:** `src/GameState/MarketManager.cs`
**Estimated Time:** 8 hours

```csharp
public class MarketManager
{
    // Add location-specific pricing data
    private Dictionary<string, Dictionary<string, ItemPricing>> locationPrices;
    
    public class ItemPricing
    {
        public int BuyPrice { get; set; }
        public int SellPrice { get; set; }
        public float SupplyLevel { get; set; } // 0.0 to 2.0, affects pricing
    }
    
    public void InitializeLocationPricing()
    {
        locationPrices = new Dictionary<string, Dictionary<string, ItemPricing>>
        {
            ["town_square"] = new Dictionary<string, ItemPricing>
            {
                ["herbs"] = new ItemPricing { BuyPrice = 3, SellPrice = 2, SupplyLevel = 1.2f },
                ["tools"] = new ItemPricing { BuyPrice = 8, SellPrice = 6, SupplyLevel = 0.8f },
                // ... more items
            },
            ["dusty_flagon"] = new Dictionary<string, ItemPricing>
            {
                ["herbs"] = new ItemPricing { BuyPrice = 2, SellPrice = 1, SupplyLevel = 1.5f },
                ["food"] = new ItemPricing { BuyPrice = 1, SellPrice = 1, SupplyLevel = 2.0f },
                // ... more items
            }
        };
    }
    
    public int GetItemPrice(string locationId, string itemId, bool isBuyPrice)
    {
        if (locationPrices.ContainsKey(locationId) && 
            locationPrices[locationId].ContainsKey(itemId))
        {
            ItemPricing pricing = locationPrices[locationId][itemId];
            return isBuyPrice ? pricing.BuyPrice : pricing.SellPrice;
        }
        return 0; // Item not available at location
    }
    
    public List<string> GetProfitableItems(string currentLocation, string destinationLocation)
    {
        // Calculate arbitrage opportunities
        List<string> profitableItems = new List<string>();
        // ... implementation
        return profitableItems;
    }
}
```

**Acceptance Criteria:**
- [ ] Each location has unique item prices
- [ ] Clear arbitrage opportunities exist
- [ ] Price differences reward strategic planning
- [ ] UI shows profit potential

#### Task 3.2: Create Profit Calculation Tools
**File:** `src/UIHelpers/TradingHelper.cs` (new file)
**Estimated Time:** 4 hours

```csharp
public class TradingHelper
{
    public class ProfitCalculation
    {
        public string ItemName { get; set; }
        public int BuyPrice { get; set; }
        public int SellPrice { get; set; }
        public int Profit { get; set; }
        public float ProfitMargin { get; set; }
    }
    
    public List<ProfitCalculation> CalculateProfits(
        string currentLocation, 
        string destinationLocation,
        List<string> availableItems)
    {
        // Calculate profit for each item between locations
    }
    
    public int CalculateInventoryValue(Inventory inventory, string locationId)
    {
        // Calculate total sell value of current inventory at location
    }
}
```

### ðŸš— Route Selection Interface

#### Task 4.1: Create Route Selection UI
**File:** `src/Pages/RouteSelection.razor` (new file)
**Estimated Time:** 6 hours

```razor
@page "/route-selection"
@inject GameWorldManager GameManager

<div class="route-selection-container">
    <h3>Select Travel Route to @DestinationLocation</h3>
    
    <div class="current-resources">
        <span>Coins: @player.Coins</span>
        <span>Stamina: @player.Stamina/@player.MaxStamina</span>
        <span>Time Blocks: @remainingTimeBlocks/5</span>
    </div>
    
    <div class="route-options">
        @foreach (var route in availableRoutes)
        {
            <div class="route-option @(CanAffordRoute(route) ? "" : "disabled")">
                <h4>@route.Name</h4>
                <div class="route-costs">
                    <div class="cost-item">
                        <span class="cost-type">Time:</span>
                        <span class="cost-value">@route.TimeBlockCost blocks</span>
                    </div>
                    <div class="cost-item">
                        <span class="cost-type">Coins:</span>
                        <span class="cost-value">@route.BaseCoinCost</span>
                    </div>
                    <div class="cost-item">
                        <span class="cost-type">Stamina:</span>
                        <span class="cost-value">@CalculateStaminaCost(route)</span>
                    </div>
                </div>
                <p class="route-description">@route.Description</p>
                <button class="select-route-btn" 
                        disabled="@(!CanAffordRoute(route))"
                        @onclick="() => SelectRoute(route)">
                    Select Route
                </button>
            </div>
        }
    </div>
</div>

@code {
    [Parameter] public string DestinationLocation { get; set; }
    
    private Player player;
    private List<RouteOption> availableRoutes;
    private int remainingTimeBlocks;
    
    protected override void OnInitialized()
    {
        player = GameManager.GetGameWorld().GetPlayer();
        availableRoutes = GetAvailableRoutes();
        remainingTimeBlocks = CalculateRemainingTimeBlocks();
    }
    
    private bool CanAffordRoute(RouteOption route)
    {
        return player.Coins >= route.BaseCoinCost &&
               player.Stamina >= CalculateStaminaCost(route) &&
               remainingTimeBlocks >= route.TimeBlockCost;
    }
    
    private int CalculateStaminaCost(RouteOption route)
    {
        // Use TravelManager to calculate weight-adjusted cost
        return GameManager.TravelManager.CalculateStaminaCost(route);
    }
    
    private void SelectRoute(RouteOption route)
    {
        // Execute travel and navigate to destination
        GameManager.TravelManager.TravelToLocation(
            DestinationLocation, 
            route.DestinationLocationSpot, 
            route);
        
        // Navigate to destination location UI
        Navigation.NavigateTo($"/location/{DestinationLocation}");
    }
}
```

**Acceptance Criteria:**
- [ ] Shows all available routes with costs
- [ ] Displays current resources clearly
- [ ] Disables unaffordable routes
- [ ] Shows weight impact on stamina costs
- [ ] Provides route selection confirmation

---

## Medium Priority Tasks (Week 3)

### ðŸ“‹ Contract System Completion

#### Task 5.1: Implement Contract Deadline Logic
**File:** `src/Game/MainSystem/ContractSystem.cs`
**Estimated Time:** 6 hours

```csharp
public class ContractSystem
{
    private GameWorld gameWorld;
    private List<Contract> activeContracts;
    
    public bool IsContractExpired(Contract contract)
    {
        return gameWorld.CurrentDay > contract.DueDay;
    }
    
    public bool CanCompleteContract(Contract contract)
    {
        Player player = gameWorld.GetPlayer();
        
        // Check if player has required items
        foreach (string requiredItem in contract.RequiredItems)
        {
            if (!player.Inventory.HasItem(requiredItem))
                return false;
        }
        
        // Check if at correct location
        if (player.CurrentLocation?.Id != contract.DestinationLocation)
            return false;
            
        return true;
    }
    
    public ContractResult CompleteContract(Contract contract)
    {
        if (IsContractExpired(contract))
        {
            return new ContractResult 
            { 
                Success = false, 
                Message = "Contract expired",
                ReputationPenalty = -5
            };
        }
        
        if (!CanCompleteContract(contract))
        {
            return new ContractResult 
            { 
                Success = false, 
                Message = "Requirements not met" 
            };
        }
        
        // Remove required items from inventory
        Player player = gameWorld.GetPlayer();
        foreach (string item in contract.RequiredItems)
        {
            player.Inventory.RemoveItem(item);
        }
        
        // Award payment
        player.AddCoins(contract.Payment);
        
        return new ContractResult 
        { 
            Success = true, 
            Message = $"Contract completed! Earned {contract.Payment} coins",
            CoinsEarned = contract.Payment
        };
    }
    
    public void ProcessDailyContractChecks()
    {
        List<Contract> expiredContracts = activeContracts
            .Where(c => IsContractExpired(c))
            .ToList();
            
        foreach (Contract expired in expiredContracts)
        {
            // Apply failure penalties
            ApplyContractFailurePenalty(expired);
            activeContracts.Remove(expired);
        }
    }
}

public class ContractResult
{
    public bool Success { get; set; }
    public string Message { get; set; }
    public int CoinsEarned { get; set; }
    public int ReputationPenalty { get; set; }
}
```

#### Task 5.2: Update Contract UI
**File:** `src/Pages/ContractUI.razor`
**Estimated Time:** 4 hours

- Add progress tracking display
- Show time remaining with visual urgency
- Add completion button when requirements met
- Display failure consequences clearly

### ðŸŽ¨ Style Cleanup Tasks

#### Task 6.1: Replace var Usage
**Files:** Multiple (8 files identified)
**Estimated Time:** 2 hours

**Search and replace pattern:**
```csharp
// Find: var (\w+) = 
// Replace with explicit type based on context
```

**Priority files:**
1. `src/GameState/GameWorldManager.cs`
2. `src/GameState/GameWorld.cs`
3. `src/Game/EvolutionSystem/WorldStateInputBuilder.cs`
4. `src/Game/EncounterSystem/ChoiceProjectionService.cs`

#### Task 6.2: Minimize Lambda Usage
**Files:** High-usage files from analysis
**Estimated Time:** 4 hours

**Pattern to follow:**
```csharp
// Instead of: items.Where(i => i.IsAvailable).ToList()
// Use: items.Where(IsItemAvailable).ToList()

private bool IsItemAvailable(Item item)
{
    return item.IsAvailable;
}
```

---

## Testing and Validation Tasks

### ðŸ§ª Integration Testing

#### Task 7.1: Economic Loop Testing
**Estimated Time:** 4 hours

**Test Scenarios:**
- [ ] Complete day with all 5 time blocks used
- [ ] Attempt to exceed time block limit
- [ ] Test stamina constraint on travel choices
- [ ] Verify inventory pressure affects decisions
- [ ] Test contract deadline enforcement

#### Task 7.2: Trading Profitability Testing
**Estimated Time:** 2 hours

**Test Scenarios:**
- [ ] Identify profitable arbitrage routes
- [ ] Verify price differences create strategy
- [ ] Test inventory limitation effects
- [ ] Validate profit calculations

#### Task 7.3: Balance Validation
**Estimated Time:** 3 hours

**Validation Points:**
- [ ] Ensure constraints create meaningful choices
- [ ] Verify no dominant strategy exists
- [ ] Test multiple viable approaches
- [ ] Confirm time pressure effectiveness

---

## Documentation Tasks

### ðŸ“š Code Documentation

#### Task 8.1: Update CLAUDE.md
**File:** `CLAUDE.md`
**Estimated Time:** 1 hour

- Document new constraint systems
- Update development commands
- Add testing procedures

#### Task 8.2: Create Developer Guide
**File:** `developer-guide.md` (new)
**Estimated Time:** 2 hours

- Economic system interaction guide
- Adding new locations/items guide
- Balance testing procedures

---

## Completion Checklist

### âœ… Phase 1: Foundation Systems
- [ ] Time block limit enforcement (5 per day)
- [ ] Stamina pool adjustment (6 points daily)
- [ ] Inventory reduction (6 slots)
- [ ] Basic constraint testing

### âœ… Phase 2: Trading Foundation  
- [ ] Dynamic location-based pricing
- [ ] Arbitrage opportunity creation
- [ ] Profit calculation tools
- [ ] Route selection UI

### âœ… Phase 3: Goal Structure
- [ ] Contract deadline enforcement
- [ ] Contract completion/failure logic
- [ ] Progress tracking UI
- [ ] Time pressure integration

### âœ… Phase 4: Polish and Balance
- [ ] Style cleanup (var removal)
- [ ] Lambda expression reduction
- [ ] Balance testing completion
- [ ] UI polish and improvement

**Total Estimated Time:** 60-80 hours over 4 weeks

---

## Success Metrics Tracking

### ðŸ“Š Validation Criteria

**Players should consistently experience:**
- [ ] "Everything costs something else" decisions
- [ ] Time pressure affecting strategy choices
- [ ] Resource trade-offs in every major decision
- [ ] Multiple viable strategic approaches

**Technical validation:**
- [ ] All UserStories.md acceptance criteria met
- [ ] Code follows style preferences
- [ ] Performance remains smooth
- [ ] Easy content addition capability

Use this task list to track implementation progress and ensure the POC achieves its economic simulation vision.