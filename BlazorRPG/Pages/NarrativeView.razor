@inherits NarrativeViewBase

<div class="narrative-container">
    <div class="narrative-text">
        @if (ShowResult)
        {
            <h3>
                @(Result.encounterResults switch
                {
                    EncounterResults.EncounterSuccess => "Encounter Won!",
                    EncounterResults.EncounterFailure => "Encounter Lost",
                    EncounterResults.GameOver => "Game Over",
                    _ => ""
                })
            </h3>


            @if (!string.IsNullOrEmpty(Result.EncounterEndMessage))
            {
                <div class="narrative-message">
                    @((MarkupString)Result.EncounterEndMessage)
                </div>
            }

            @if (Result.encounterResults == EncounterResults.EncounterSuccess && Result.encounter.Context.ActionImplementation.Rewards.Any())
            {
                <div class="tooltip-section">
                    <h5>Rewards</h5>
                    <div class="tooltip-list">
                        @foreach (Outcome reward in Result.encounter.Context.ActionImplementation.Rewards)
                        {
                            <div class="tooltip-item">
                                <div class="tooltip-item-header">
                                    <div class="tooltip-item-title">
                                        @GetOutcomeIcon(reward)
                                        <span class="tooltip-item-name">@reward.GetDescription()</span>
                                    </div>
                                    <span class="tooltip-item-value positive-change">
                                        @reward.GetPreview(GameState.Player)
                                    </span>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }

            @if (Result.encounterResults == EncounterResults.EncounterFailure && Result.encounter.Context.ActionImplementation.Costs.Any())
            {
                <div class="tooltip-section">
                    <h5>Costs</h5>
                    <div class="tooltip-list">
                        @foreach (Outcome cost in Result.encounter.Context.ActionImplementation.Costs)
                        {
                            <div class="tooltip-item">
                                <div class="tooltip-item-header">
                                    <div class="tooltip-item-title">
                                        @GetOutcomeIcon(cost)
                                        <span class="tooltip-item-name">@cost.GetDescription()</span>
                                    </div>
                                    <span class="tooltip-item-value negative-change">
                                        @cost.GetPreview(GameState.Player)
                                    </span>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }

            <div class="tooltip-section">
                <h5>Energy Costs</h5>
                <div class="tooltip-list">
                    @foreach (Outcome cost in GetEnergyCosts())
                    {
                        <div class="tooltip-item">
                            <div class="tooltip-item-header">
                                <div class="tooltip-item-title">
                                    @GetOutcomeIcon(cost)
                                    <span class="tooltip-item-name">@cost.GetDescription()</span>
                                </div>
                                <span class="tooltip-item-value negative-change">
                                    @cost.GetPreview(GameState.Player)
                                </span>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
        else if (!string.IsNullOrEmpty(NarrativeText))
        {
            <p>@((MarkupString)NarrativeText)</p>
        }
    </div>

    <button class="narrative-button" @onclick="OnNarrativeCompleted">
        Continue
    </button>
</div>

