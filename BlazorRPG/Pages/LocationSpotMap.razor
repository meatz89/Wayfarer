@* LocationSpotMap.razor *@
@inject ActionManager ActionManager
@inject GameState GameState

<div class="locations-grid">
    @foreach (LocationSpot spot in CurrentLocation.Spots)
    {
        <div class="location-card @(spot.Name == CurrentSpot.Name ? "current" : "reachable")">
            <div class="location-name">
                @spot.Name @(spot.Name == CurrentSpot.Name ? "(Current)" : "")
            </div>
            <div class="location-type">@spot.Name</div>

            @if (spot.Name == CurrentSpot.Name)
            {
                @foreach (var action in GameState.ValidLocationSpotActions.Where(x => x.LocationSpot == spot.Name))
                {
                    <button class="action-button"
                            @onclick="() => OnActionSelected.InvokeAsync(action)"
                            disabled="@(!ActionManager.AreRequirementsMet(action))"
                            @onmouseover="(e) => ShowTooltip(action, e)"
                            @onmouseout="HideTooltip">
                        @action.BasicAction.Name (@action.BasicAction.Name)
                    </button>
                }
            }
            else
            {
                <button class="action-button"
                        @onclick="() => OnSpotSelected.InvokeAsync(spot)"
                        disabled="@(!ActionManager.CanMoveToSpot(spot.Name))">
                    MOVE HERE
                </button>
            }
        </div>
    }
</div>

@code {
    [Parameter] public Location CurrentLocation { get; set; }
    [Parameter] public LocationSpot CurrentSpot { get; set; }
    [Parameter] public EventCallback<LocationSpot> OnSpotSelected { get; set; }
    [Parameter] public EventCallback<UserActionOption> OnActionSelected { get; set; }
    [Parameter] public Action<UserActionOption, MouseEventArgs> ShowTooltip { get; set; }
    [Parameter] public Action HideTooltip { get; set; }
}