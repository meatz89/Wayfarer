@page "/"
@inherits ComponentBase

<div class="top-bar">
    <div class="time-display">
        @CurrentHour:00
        @CurrentTime 🌅
    </div>

    <div class="energy-meters">
        <div class="energy-meter">
            <div class="meter-bar">
                <div class="meter-fill physical" style="width: @(physicalEnergyCurrent * 100 / physicalEnergyMax)%"></div>
            </div>
            <span>Physical (@physicalEnergyCurrent/@physicalEnergyMax)</span>
        </div>
        <div class="energy-meter">
            <div class="meter-bar">
                <div class="meter-fill focus" style="width: @(focusEnergyCurrent * 100 / focusEnergyMax)%"></div>
            </div>
            <span>Focus (@focusEnergyCurrent/@focusEnergyMax)</span>
        </div>
        <div class="energy-meter">
            <div class="meter-bar">
                <div class="meter-fill social" style="width: @(socialEnergyCurrent * 100 / socialEnergyMax)%"></div>
            </div>
            <span>Social (@socialEnergyCurrent/@socialEnergyMax)</span>
        </div>
    </div>

    <div class="resources">
        <div class="resource coins">
            <span class="resource-icon">🪙</span>
            <span class="resource-value">@coins</span>
            <span class="resource-label">Coins</span>
        </div>
        <div class="resource food">
            <span class="resource-icon">🍖</span>
            <span class="resource-value">@food</span>
            <span class="resource-label">Food</span>
        </div>
        <div class="resource health">
            <span class="resource-icon">❤️</span>
            <span class="resource-value">@health/@maxHealth</span>
            <span class="resource-label">Health</span>
        </div>
        <div class="resource concentration">
            <span class="resource-icon">🎯</span>
            <span class="resource-value">@concentration/@maxConcentration</span>
            <span class="resource-label">Concentration</span>
        </div>
        <div class="resource reputation">
            <span class="resource-icon">🏆</span>
            <span class="resource-value">@reputation/@maxReputation</span>
            <span class="resource-label">Reputation</span>
        </div>
    </div>
</div>

<div class="game-container">
    <div class="map-container">
        <div class="map-toggle">
            <button class="toggle-button @(showAreaMap ? "active" : "")" @onclick="() => showAreaMap = true">
                Travel 🗺️
            </button>
        </div>

        @if (HasEncounter())
        {
            <EncounterView OnEncounterCompleted="HandleEncounterCompleted" />
        }
        else
        {
            @if (showAreaMap)
            {
                <AreaMap CurrentLocation="@CurrentLocation"
                         Locations="@Locations"
                         OnTravel="@HandleLocationSelection"/>
            }
            else
            {
                <LocationSpotMap CurrentLocation="@CurrentLocation"
                                 CurrentSpot="@CurrentSpot"
                                 OnSpotSelected="@HandleSpotSelection"
                                 OnActionSelected="@HandleActionSelection" />
            }
        }

    </div>

    <div class="sidebar">

<div class="sidebar-panel location-panel">
    <div class="location-name">
        @CurrentLocation.LocationName
    </div>

    <div class="location-properties">
        <div class="properties-header">Properties</div>
            <div class="properties-grid">
                    @foreach (var prop in GetLocationPropertiesWithEffects())
                    {
                        if (prop.Effects.Count > 0)
                        {
                            <div class="property-tag @prop.CssClass" data-tooltip="@string.Join(" | ", prop.Effects)">
                                <span class="property-icon">@prop.Icon</span>
                                <span class="property-text">@prop.Text</span>
                                <span class="effect-indicator">✨</span>
                            </div>
                        }
                        else
                        {
                            <div class="property-tag @prop.CssClass">
                                <span class="property-icon">@prop.Icon</span>
                                <span class="property-text">@prop.Text</span>
                            </div>
                        }
                    }
                </div>
            <ul class="property-effects">
                @foreach (var prop in GetLocationPropertiesWithEffects())
                {
                    @foreach (var effect in prop.Effects)
                    {
                        <li>@effect</li>
                    }
                }
            </ul>

            </div>
        </div>

        <div class="sidebar-panel">
            <div class="panel-title">Daily Requirements</div>
            <div class="panel-content">
                @*                 <div class="requirement">
                    <span style="color: var(--resource-food)">
                        • @baseRequirements.DailyFood Food by Night
                        @if (modifiedRequirements.DailyFood > baseRequirements.DailyFood)
                        {
                            <span class="modifier">
                                (+@(modifiedRequirements.DailyFood - baseRequirements.DailyFood)
                                from @GetModifierSource())
                            </span>
                        }
                    </span>
                </div> *@
                <div class="requirement">
                    <span style="color: var(--resource-food)">• 1 Food by Night</span>
                </div>
                <div class="requirement">
                    <span style="color: var(--resource-shelter)">• Shelter during Night</span>
                </div>
            </div>
        </div>

        <div class="sidebar-panel">
            <div class="panel-title">Time Management</div>
            <div class="panel-content">
                <div>• Travel takes time</div>
                <div>• Actions advance time</div>
                <div>• Plan your day carefully</div>
            </div>
        </div>

        <div class="sidebar-panel quest-effects">
            <div class="panel-title">Quest Effects</div>
            <div class="panel-content">
                @foreach (Quest activeQuest in GetActiveQuests())
                {
                    QuestStep questStep = activeQuest.GetCurrentStep();
                    @if(questStep != null)
                    {
                        @foreach (IGameStateModifier modifier in questStep.StateModifiers)
                        {
                            <div class="quest-effect">
                                <div class="effect-source">@activeQuest.Title:</div>
                                <div class="effect-description">
                                    @GetModifierDescription(modifier)
                                </div>
                            </div>
                        }
                    }
                }
            </div>
        </div>
    </div>
</div>

@if (showTooltip && hoveredAction != null)
{
    <div class="tooltip" style="left: @(mouseX + 10)px; top: @(mouseY + 10)px">
        <ActionPreview CurrentAction="@hoveredAction"
                       Player="@Player" />
    </div>
}