@page "/"
@inherits ComponentBase

<div class="game-container">
    <CascadingValue Value="CurrentScreen">
        <GameScreen Screen="CurrentScreen">
            <MainGameScreen>
                <h2>Main Menu</h2>
                <MenuOptions>
                    <MenuOption Index="1" Text="New Game" OnClick="ToActionSelection" />
                    <BackOption Text="Exit Game" OnBack="ExitGame" />
                </MenuOptions>
            </MainGameScreen>

            <StatusScreen>
                <h2>Current Status</h2>
                <StatusInfo GameState="GameState" />
                <MenuOptions>
                    <br />
                    <BackOption OnBack="PopScreen" />
                </MenuOptions>
            </StatusScreen>

            <ActionSelectionScreen>
                <h2>Location: @GetCurrentLocation()</h2>
                <MenuOptions>
                    @foreach (var action in CurrentActions)
                    {
                        <MenuOption Index="action.Index"
                                    Text="@action.Description"
                                    OnClick="() => HandleActionSelection(action)" />
                    }
                    <br />
                    <BackOption OnBack="PopScreen" />
                </MenuOptions>
            </ActionSelectionScreen>

            <TravelScreen>
                <h2>Travel To</h2>
                <MenuOptions>
                    @foreach (var travelOption in CurrentTravelOptions)
                    {
                        <MenuOption Index="travelOption.Index"
                                    Text="@travelOption.Location.ToString()"
                                    OnClick="() => HandleTravel(travelOption.Index)" />
                    }
                    <br />
                    <BackOption OnBack="PopScreen" />
                </MenuOptions>
            </TravelScreen>

            <NarrativeScreen>
                @if (GameState.CurrentNarrative != null)
                {
                    @if (GameState.CurrentNarrativeStage != null)
                    {
                        <h2>Current Situation</h2>
                        <p class="narrative-text">@GameState.CurrentNarrativeStage.Situation</p>
                        <MenuOptions>
                            @foreach (var choice in GameState.CurrentNarrativeStage.Choices)
                            {
                                var canExecute = ActionManager.CanExecuteChoice(GameState.CurrentNarrativeStage, choice.Index);
                                <MenuOption Index="choice.Index"
                                            Text="@choice.Description"
                                            IsDisabled="!canExecute"
                                            OnClick="() => HandleNarrativeChoice(choice.Index)" />
                            }
                            <br />
                            <BackOption OnBack="PopScreen" />
                        </MenuOptions>
                    }
                }
            </NarrativeScreen>

            <ActionResultScreen>
                <h2>Action Result</h2>
                <MenuOptions>
                    @if (LastActionResult != null)
                    {
                        <div class="@(LastActionResult.IsSuccess ? "success-message" : "error-message")">
                            <p>@(LastActionResult.IsSuccess ? "Success" : "Failure")</p>
                            <p>Rewards:</p>
                            @foreach (var message in ResultMessages)
                            {
                                @message
                                <br />
                            }
                        </div>
                    }
                    <br />
                    <MenuOption Index="1" Text="To Action Selection" OnClick="ToActionSelection" />
                </MenuOptions>
            </ActionResultScreen>

        </GameScreen>
    </CascadingValue>

    <ActionResultMessage Result="LastActionResult" />
</div>