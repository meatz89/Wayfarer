@inherits EncounterChoiceTooltipBase

<div class="tooltip" style="left: @(mouseX)px; top: @(mouseY)px;">
    <div class="preview-header">
        <h4>@hoveredChoice.Description</h4>
        <div class="choice-narrative">@hoveredChoice.Narrative</div>
    </div>

    @if (GetLocationSpotEffects(hoveredChoice.Choice).Any())
    {
        <div class="tooltip-section">
            <h5>Location Effects</h5>
            @*TODO: List the location effects*@
        </div>
    }

@*     @if (hoveredChoice.Choice.CalculationResult.Requirements.Count > 0)
    {
        <div class="tooltip-section">
            <h5>Requirements</h5>
            <div class="tooltip-list">
                @foreach (DetailedRequirement req in GetDetailedRequirements(hoveredChoice.Choice))
                {
                    <div class="tooltip-item">
                        <div class="tooltip-item-header">
                            <div class="tooltip-item-title">
                                @GetRequirementIcon(req.RequirementType)
                                <span class="tooltip-item-name">@req.Description</span>
                            </div>
                            <span class="tooltip-item-value @(req.IsSatisfied ? "positive-change" : "negative-change")">
                                @(req.IsSatisfied ? "✓" : "✗")
                            </span>
                        </div>
                    </div>
                }
            </div>
        </div>
    } *@

    <div class="tooltip-section">
        <h5>Encounter Value Changes</h5>
        <div class="tooltip-list">
            @foreach (DetailedChange dc in GetValueChanges(hoveredChoice.Choice)
            .Where(c => c.ChangeType != ChangeTypes.PhysicalEnergy
            && c.ChangeType != ChangeTypes.Concentration
            && c.ChangeType != ChangeTypes.Reputation))
            {
                <div class="tooltip-item">
                    <div class="tooltip-item-header">
                        <div class="tooltip-item-title">
                            @GetValueTypeIcon(dc.ChangeType)
                            <span class="tooltip-item-name">@dc.ChangeType</span>
                        </div>
                    </div>
                    @if (dc.ChangeValues.Sources.Any())
                    {
                        <div class="tooltip-item-details">
                            @foreach (var detail in dc.ChangeValues.Sources)
                            {
                                <div class="tooltip-detail-line">@detail</div>
                            }
                        </div>
                    }
                </div>
            }
        </div>
    </div>

    @{
        var energyChanges = GetValueChanges(hoveredChoice.Choice)
        .Where(c => c.ChangeType == ChangeTypes.PhysicalEnergy
        || c.ChangeType == ChangeTypes.Concentration
        || c.ChangeType == ChangeTypes.Reputation)
        .ToList();
    }
    @if (energyChanges.Any())
    {
        <div class="tooltip-section">
            <h5>Energy Costs</h5>
            <div class="tooltip-list">
                @foreach (DetailedChange energy in energyChanges)
                {
                    <div class="tooltip-item">
                        <div class="tooltip-item-header">
                            <div class="tooltip-item-title">
                                @GetValueTypeIcon(energy.ChangeType)
                                <span class="tooltip-item-name">@energy.ChangeType.ToString().Replace("Energy", "")</span>
                            </div>
                            <span class="tooltip-item-value negative-change">
                                @energy.ChangeValues.TotalAmount
                            </span>
                        </div>
                        @if (energy.ChangeValues.Sources.Any())
                        {
                            <div class="tooltip-item-details">
                                @foreach (var detail in energy.ChangeValues.Sources)
                                {
                                    <div class="tooltip-detail-line">@detail</div>
                                }
                            </div>
                        }
                    </div>
                }
            </div>
        </div>
    }
@* 
    @if (hoveredChoice.Choice.CalculationResult.Costs.Count > 0)
    {
        <div class="tooltip-section">
            <h5>Costs</h5>
            <div class="tooltip-list">
                @foreach (Outcome cost in hoveredChoice.Choice.CalculationResult.Costs)
                {
                    <div class="tooltip-item">
                        <div class="tooltip-item-header">
                            <div class="tooltip-item-title">
                                @GetOutcomeIcon(cost)
                                <span class="tooltip-item-name">@cost.GetDescription()</span>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    }

    @if (hoveredChoice.Choice.CalculationResult.Rewards.Count > 0)
    {
        <div class="tooltip-section">
            <h5>Rewards</h5>
            <div class="tooltip-list">
                @foreach (Outcome reward in hoveredChoice.Choice.CalculationResult.Rewards)
                {
                    <div class="tooltip-item">
                        <div class="tooltip-item-header">
                            <div class="tooltip-item-title">
                                @GetOutcomeIcon(reward)
                                <span class="tooltip-item-name">@reward.GetDescription()</span>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    } *@
</div>