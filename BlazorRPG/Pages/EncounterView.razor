@inherits EncounterViewBase
@using Microsoft.AspNetCore.Components.Web

<div class="encounter-container">
    @if (IsLoading)
    {
        <div class="encounter-loading">
            Loading...
        </div>
    }

    <!-- Universal Encounter System Status Display -->
    <div class="encounter-stats">
        <div class="stat">
            <span class="stat-label">Focus</span>
            <span class="stat-value">@GetCurrentFocusPoints() / @GetMaxFocusPoints()</span>
        </div>
    </div>

    <div class="encounter-content">
        <div class="encounter-main">
            <div class="encounter-stage">
                <div class="stage-header">
                    <div class="choice-set-name">Choice Set</div>
                </div>
                <div class="stage-situation">@Model.EncounterResult.NarrativeResult?.SceneNarrative</div>
            </div>

            <div class="encounter-choices">
                @if (CurrentChoices.Count > 0)
                {
                    @foreach (UserEncounterChoiceOption choice in CurrentChoices)
                    {
                        bool canAfford = true;
                        bool isDisabled = IsChoiceDisabled(choice) || !canAfford;

                        <div id="choice-@choice.Index"
                             class="choice-option @(isDisabled ? "disabled" : "")"
                             @onclick="(() => HandleChoiceSelection(choice))"
                             @onmouseover="@(() => ShowTooltip(choice, $"choice-{choice.Index}"))"
                             @onmouseout="HideTooltip">

                            <div class="choice-index">@choice.Index</div>

                            <div class="choice-name">
                                @choice.Choice.ChoiceID
                                @if (GetFocusCost(choice) > 0)
                                {
                                    <span class="status-value">⚡@GetFocusCost(choice)</span>
                                }
                            </div>

                            @if (!canAfford)
                            {
                                <div class="blocked-reason">Insufficient Focus</div>
                            }
                        </div>
                    }
                }
            </div>
        </div>
    </div>

    @if (showTooltip && hoveredChoice != null)
    {
        <EncounterChoiceTooltip hoveredChoice="hoveredChoice" tooltipX="tooltipX" tooltipY="tooltipY" />
    }
</div>