@inherits EncounterViewBase
@using Microsoft.AspNetCore.Components.Web

<div class="encounter-container">
    @if (IsLoading)
    {
        <div class="encounter-loading">
            Loading...
        </div>
    }
    <div class="encounter-content">
        <div class="encounter-main">
            <div class="encounter-stage">
                <div class="stage-header">
                    <div class="choice-set-name">Chosen Action: @Model.EncounterResult.NarrativeResult?.LastChoiceNarrative.ShorthandName</div>
                </div>
                <div class="stage-situation">@Model.EncounterResult.NarrativeResult?.SceneNarrative</div>
            </div>

            <div class="encounter-choices">
                @if(CurrentChoices.Count > 0)
                {
                    @foreach (UserEncounterChoiceOption choice in CurrentChoices)
                    {
                        <div id="choice-@choice.Index" class="choice-option @(IsChoiceDisabled(choice) ? "disabled" : "")"
                             @onclick="(() => HandleChoiceSelection(choice))"
                             @onmouseover="@(() => ShowTooltip(choice, $"choice-{choice.Index}"))"
                             @onmouseout="HideTooltip">

                            <div class="choice-index">@choice.Index</div>
                            <div class="choice-name">@GetChoiceName(choice)</div>
                        </div>
                    }
                }
            </div>
        </div>
    </div>

    @if (showTooltip && hoveredChoice != null)
    {
        <EncounterChoiceTooltip hoveredChoice="hoveredChoice" tooltipX="tooltipX" tooltipY="tooltipY" />
    }
</div>
